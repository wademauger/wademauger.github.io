{"version":3,"mappings":"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","names":["ThunderboltOutlined","props","ref","AntdIcon","_extends","ThunderboltOutlinedSvg","RefIcon","React.forwardRef","LibraryOpenDialog","visible","onClose","onOpen","dispatch","useDispatch","entries","useSelector","state","isLoading","isSignedIn","selectedFile","scanResults","setScanResults","useState","persistedFileRef","raw","parsed","i","key","val","detectPersistedLibrary","results","canonicalRaw","message","handleOpen","item","loadFullLibraryById","__vitePreload","lib","openEntry","n","res","entry","err","handleOpenSettings","openLibrarySettingsModal","jsx","Modal","jsxs","Typography","Button","loadFullLibrary","fileRefToOpen","panelEntries","k","List","p","r","Spin","LibrarySaveDialog","fileId","libraryData","onSave","filename","setFilename","isSaving","setSaving","handleOpenLibrarySettings","handleSave","saveEntry","noLibrary","Input","e","KnittingDesignerApp","lazy","WizardView","Title","Text","Content","Layout","ColorworkDesignerApp","savedPatterns","setSavedPatterns","currentProject","setCurrentProject","knittingStage","setKnittingStage","useRef","recentProjects","useMemo","handleLoadProject","project","fixedProject","fixLegacyProject","navigate","useNavigate","location","useLocation","panelShape","renderHomeView","Row","Col","Card","PlusOutlined","BgColorsOutlined","pattern","setMenuItems","useDropdown","showOpenDialog","setShowOpenDialog","showSaveDialog","setShowSaveDialog","showPatternOpen","setShowPatternOpen","showPatternSaveAs","setShowPatternSaveAs","currentPatternData","setCurrentPatternData","useEffect","handlePatternData","event","gridSize","colors","path","items","DriveAuthProvider","fileRef","emitEvent","result","Routes","Route","PanelShapeCreator","OpenModal","SaveAsModal","name","patternData"],"ignoreList":[0,1],"sources":["../../../node_modules/@ant-design/icons-svg/es/asn/ThunderboltOutlined.js","../../../node_modules/@ant-design/icons/es/icons/ThunderboltOutlined.js","../../../src/components/LibraryOpenDialog.tsx","../../../src/components/LibrarySaveDialog.tsx","../../../src/apps/colorwork-designer/ColorworkDesignerApp.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar ThunderboltOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z\" } }] }, \"name\": \"thunderbolt\", \"theme\": \"outlined\" };\nexport default ThunderboltOutlined;\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport ThunderboltOutlinedSvg from \"@ant-design/icons-svg/es/asn/ThunderboltOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar ThunderboltOutlined = function ThunderboltOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: ThunderboltOutlinedSvg\n  }));\n};\n\n/**![thunderbolt](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTg0OCAzNTkuM0g2MjcuN0w4MjUuOCAxMDljNC4xLTUuMy40LTEzLTYuMy0xM0g0MzZjLTIuOCAwLTUuNSAxLjUtNi45IDRMMTcwIDU0Ny41Yy0zLjEgNS4zLjcgMTIgNi45IDEyaDE3NC40bC04OS40IDM1Ny42Yy0xLjkgNy44IDcuNSAxMy4zIDEzLjMgNy43TDg1My41IDM3M2M1LjItNC45IDEuNy0xMy43LTUuNS0xMy43ek0zNzguMiA3MzIuNWw2MC4zLTI0MUgyODEuMWwxODkuNi0zMjcuNGgyMjQuNkw0ODcgNDI3LjRoMjExTDM3OC4yIDczMi41eiIgLz48L3N2Zz4=) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(ThunderboltOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ThunderboltOutlined';\n}\nexport default RefIcon;","import React, { useEffect, useState } from 'react';\nimport { Modal, List, Spin, message, Typography, Button } from 'antd';\nimport { useDispatch, useSelector } from 'react-redux';\nimport type { RootState, AppDispatch } from '../store';\nimport store from '../store';\n// We'll dynamically import library thunks from utils to avoid initializing Drive services on module load\nimport { openLibrarySettingsModal } from '../reducers/modal.reducer';\n\ninterface Props {\n  visible: boolean;\n  onClose: () => void;\n  onOpen?: (library: any, fileRef?: any) => void;\n}\n\nexport default function LibraryOpenDialog({ visible, onClose, onOpen }: Props) {\n  const dispatch = useDispatch<AppDispatch>();\n  const entries = useSelector((state: RootState) => state.library.entries || []);\n  const isLoading = useSelector((state: RootState) => state.library.isLoading);\n  const isSignedIn = useSelector((state: RootState) => state.auth?.isSignedIn);\n  const selectedFile = useSelector((state: RootState) => state.library?.selectedFile);\n  const [scanResults, setScanResults] = useState<Array<{ key: string; value: any }>>([]);\n  // Fallback: probe localStorage for persisted library references in several places\n  // 1) canonical app key 'app:libraryFileReference'\n  // 2) user preference blobs created by GoogleDriveServiceModern (e.g. songsUserPreferences_{email})\n  // 3) googleDriveSettings_{email}\n  // We'll try to extract an id (preferred) or at least a filename.\n  let persistedFileRef: { id?: string; name?: string } | null = null;\n  try {\n    // Primary canonical key\n    const raw = localStorage.getItem('app:libraryFileReference');\n    if (raw) {\n      const parsed = JSON.parse(raw);\n      if (parsed && (parsed.id || parsed.name)) persistedFileRef = { id: parsed.id, name: parsed.name };\n    }\n\n    // If not found, scan likely user preference keys for songs/recipes panels\n    if (!persistedFileRef) {\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i) || '';\n        if (key.startsWith('songsUserPreferences_') || key.startsWith('recipesUserPreferences_') || key.startsWith('songsUserPreferences_') || key.startsWith('googleDriveSettings_') || key.startsWith('songsUserPreferences_')) {\n          try {\n            const val = JSON.parse(String(localStorage.getItem(key)));\n            if (val) {\n              // Common shapes: { selectedFileId, selectedFile, songsLibraryFile, panelsLibraryFile }\n              if (val.selectedFileId) {\n                persistedFileRef = { id: val.selectedFileId, name: val.selectedFileName || val.songsLibraryFile || val.panelsLibraryFile };\n                break;\n              }\n              if (val.selectedFile && val.selectedFile.id) {\n                persistedFileRef = { id: val.selectedFile.id, name: val.selectedFile.name || val.selectedFile.fileName };\n                break;\n              }\n              // If we only have a filename, keep it as name (no id)\n              if (val.songsLibraryFile || val.recipesLibraryFile || val.panelsLibraryFile || val.songsLibraryFile) {\n                persistedFileRef = { name: val.songsLibraryFile || val.recipesLibraryFile || val.panelsLibraryFile };\n                // continue scanning to prefer an actual file id if available\n              }\n            }\n          } catch (err) {\n            // ignore JSON parse errors\n          }\n        }\n      }\n    }\n  } catch (e) {\n    // ignore parse errors; we'll treat as no persisted file\n    persistedFileRef = persistedFileRef || null;\n  }\n\n  // Do not automatically load libraries on mount. Loading requires Drive initialization.\n  // Provide a manual refresh button so users can opt-in to Drive operations.\n\n  const detectPersistedLibrary = () => {\n    const results: Array<{ key: string; value: any }> = [];\n    try {\n      // Check canonical key first\n      const canonicalRaw = localStorage.getItem('app:libraryFileReference');\n      if (canonicalRaw) {\n        try {\n          results.push({ key: 'app:libraryFileReference', value: JSON.parse(canonicalRaw) });\n        } catch (e) {\n          results.push({ key: 'app:libraryFileReference', value: canonicalRaw });\n        }\n      }\n\n      // Scan for other likely preference keys that may embed selected file references\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i) || '';\n        if (!key) continue;\n        if (\n          key.startsWith('songsUserPreferences_') ||\n          key.startsWith('recipesUserPreferences_') ||\n          key.startsWith('googleDriveSettings_') ||\n          key.startsWith('songsUserPreferences_') ||\n          key.startsWith('recipesUserPreferences_')\n        ) {\n          const raw = String(localStorage.getItem(key));\n          try {\n            results.push({ key, value: JSON.parse(raw) });\n          } catch (e) {\n            results.push({ key, value: raw });\n          }\n        }\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    setScanResults(results);\n    if (!results.length) message.info('No persisted library-related keys found in localStorage');\n    else message.success('Found ' + results.length + ' candidate keys in localStorage');\n  };\n\n  const handleOpen = async (item: any) => {\n    try {\n      // If the item represents a library file (fileId) we load the full library; otherwise\n      // attempt to open a single entry (song/recipe/panel) from the current library using openEntry.\n      if (item && item.fileId) {\n        const { loadFullLibraryById } = await import('../utils/libraryThunks');\n        const lib = await loadFullLibraryById(item.fileId);\n        onOpen && onOpen(lib, { id: item.fileId, name: item.fileName || item.name });\n      } else if (item && item.type && item.id) {\n        // Open a specific entry (panel/song/recipe)\n        const { openEntry } = await import('../store/librarySlice');\n        const res = await dispatch(openEntry({ id: item.id, type: item.type }));\n        const entry = res && res.payload ? res.payload : null;\n        onOpen && onOpen(entry, null);\n      } else {\n        onOpen && onOpen(null);\n      }\n      onClose();\n    } catch (err: any) {\n      message.error('Failed to open library: ' + String(err));\n    }\n  };\n\n  const handleOpenSettings = () => {\n    dispatch(openLibrarySettingsModal('panels'));\n    onClose();\n  };\n\n  return (\n    <Modal open={visible} title=\"Open Library\" onCancel={onClose} footer={null}>\n      {(!isSignedIn && !selectedFile && !persistedFileRef) ? (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n          <Typography.Paragraph>No Google sign-in detected. Sign in or open library settings to connect a library.</Typography.Paragraph>\n          <div>\n            <Button type=\"primary\" onClick={handleOpenSettings}>Open Library Settings</Button>\n          </div>\n        </div>\n      ) : (\n        <div>\n          <div style={{ marginBottom: 12, display: 'flex', gap: 8 }}>\n            <Button onClick={async () => {\n              try {\n                const { loadFullLibrary } = await import('../utils/libraryThunks');\n                // trigger a load to refresh state.library via helper\n                await loadFullLibrary();\n                message.success('Library refreshed');\n              } catch (err: any) {\n                message.error('Failed to refresh library: ' + String(err));\n              }\n            }}>Refresh</Button>\n            <Button onClick={() => detectPersistedLibrary()}>Detect persisted library</Button>\n            <Button onClick={handleOpenSettings}>Library Settings</Button>\n          </div>\n\n          {(selectedFile || persistedFileRef) && (\n            <div style={{ marginBottom: 12 }}>\n              <Typography.Paragraph>Selected library: <strong>{(selectedFile && (selectedFile.name || selectedFile.id)) || (persistedFileRef && (persistedFileRef.name || persistedFileRef.id))}</strong></Typography.Paragraph>\n              <Button onClick={async () => {\n                try {\n                  const fileRefToOpen = selectedFile || persistedFileRef;\n                  if (!fileRefToOpen || !fileRefToOpen.id) throw new Error('No persisted library file id available');\n                  const { loadFullLibraryById } = await import('../utils/libraryThunks');\n                  const lib = await loadFullLibraryById(fileRefToOpen.id);\n                  // If lib contains panels, present them in the entries list instead of trying to open whole library\n                  if (lib && lib.panels) {\n                    // Replace the entries view with panels list (map to list item shape)\n                    const panelEntries = Object.keys(lib.panels).map((k) => ({ id: k, type: 'panel', title: lib.panels[k].name || k, payload: lib.panels[k] }));\n                    // Show a temporary modal listing panels to open\n                    Modal.info({\n                      title: 'Panels in library',\n                      width: 640,\n                      okText: 'Close',\n                      content: (\n                        <div>\n                          <List\n                            size=\"small\"\n                            dataSource={panelEntries}\n                            renderItem={(p: any) => (\n                              <List.Item style={{ cursor: 'pointer' }} onClick={async () => {\n                                try {\n                                  onOpen && onOpen(p.payload || null, fileRefToOpen);\n                                  onClose();\n                                } catch (err) {\n                                  message.error('Failed to open panel: ' + String(err));\n                                }\n                              }}>{p.title}</List.Item>\n                            )}\n                          />\n                        </div>\n                      )\n                    });\n                  } else {\n                    onOpen && onOpen(lib, fileRefToOpen);\n                    onClose();\n                  }\n                } catch (err: any) {\n                  message.error('Failed to load selected library: ' + String(err));\n                }\n              }}>Open Selected Library</Button>\n            </div>\n          )}\n\n          {/* Debug info: show the raw selectedFile and persistedFileRef so developers can see why the dialog\n              may be showing the sign-in message even when a persisted reference exists. */}\n          <div style={{ marginTop: 8 }}>\n            <Typography.Paragraph type=\"secondary\" style={{ fontSize: 12 }}>\n              Debug: selectedFile: {JSON.stringify(selectedFile)}\n            </Typography.Paragraph>\n            <Typography.Paragraph type=\"secondary\" style={{ fontSize: 12 }}>\n              Debug: persistedFileRef: {JSON.stringify(persistedFileRef)}\n            </Typography.Paragraph>\n            {scanResults.length > 0 && (\n              <div style={{ marginTop: 6 }}>\n                <Typography.Paragraph type=\"secondary\" style={{ fontSize: 12, marginBottom: 6 }}>Detected localStorage candidates:</Typography.Paragraph>\n                {scanResults.map((r) => (\n                  <Typography.Paragraph key={r.key} type=\"secondary\" style={{ fontSize: 11, marginBottom: 4 }}>\n                    <strong>{r.key}</strong>: {JSON.stringify(r.value)}\n                  </Typography.Paragraph>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {isLoading ? <Spin /> : (\n            <List dataSource={entries} renderItem={(item: any) => (\n              <List.Item onClick={() => handleOpen(item)} style={{ cursor: 'pointer' }}>\n                {item.title || item.name || item.fileName}\n              </List.Item>\n            )} />\n          )}\n        </div>\n      )}\n    </Modal>\n  );\n}\n","import React, { useState } from 'react';\nimport { Modal, Input, message, Typography, Button } from 'antd';\nimport { useDispatch, useSelector } from 'react-redux';\nimport type { RootState, AppDispatch } from '../store';\nimport { saveEntry } from '../store/librarySlice';\nimport { openLibrarySettingsModal } from '../reducers/modal.reducer';\n\ninterface Props {\n  visible: boolean;\n  onClose: () => void;\n  fileId?: string | null;\n  libraryData?: any;\n  onSave?: (result?: any) => void;\n}\n\nexport default function LibrarySaveDialog({ visible, onClose, fileId, libraryData, onSave }: Props) {\n  const [filename, setFilename] = useState('library.json');\n  const [isSaving, setSaving] = useState(false);\n  const dispatch = useDispatch<AppDispatch>();\n  const selectedFile = useSelector((state: RootState) => state.library?.selectedFile);\n\n  const handleOpenLibrarySettings = () => {\n    // Open the global library settings modal so the user can select/create a library\n    dispatch(openLibrarySettingsModal('panels'));\n    // close this dialog since user will select a library in the modal\n    onClose();\n  };\n\n  const handleSave = async () => {\n    setSaving(true);\n    try {\n      // If there's an explicit fileId prop, try to save to that file as a full library fallback\n      if (fileId) {\n        // If the caller passed a fileId we don't have a specialized per-entry helper for that case here.\n        // Use the generic approach via saveEntry by temporarily dispatching saveEntry which will attempt\n        // to use selectedFile from state; since fileId is provided, the caller should prefer helperSaveToFile.\n        // For simplicity, if fileId is provided we'll still attempt to save the payload as a panel entry.\n        await dispatch(saveEntry({ entry: libraryData || {}, type: 'panel' })).unwrap();\n        message.success('Saved to selected library file');\n        onSave && onSave({ success: true });\n        onClose();\n        return;\n      }\n\n      // If a library is selected in global state, save this panel into the library using saveEntry\n      if (selectedFile && selectedFile.id) {\n        await dispatch(saveEntry({ entry: libraryData || {}, type: 'panel' })).unwrap();\n        message.success('Panel saved to current library');\n        onSave && onSave({ success: true });\n        onClose();\n      } else {\n        // No library selected — surface guidance and provide a link to open library settings\n        message.error('No library selected. Please choose or create a library first.');\n      }\n    } catch (err: any) {\n      message.error('Save failed: ' + String(err));\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const noLibrary = !(selectedFile && selectedFile.id) && !fileId;\n\n  return (\n    <Modal visible={visible} title={noLibrary ? 'Save Panel' : 'Save to Library'} onCancel={onClose} onOk={handleSave} confirmLoading={isSaving}>\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {noLibrary ? (\n          <div>\n            <Typography.Paragraph>\n              No library is currently selected. You must select or create a library before saving a panel.\n            </Typography.Paragraph>\n            <Button type=\"primary\" onClick={handleOpenLibrarySettings}>Open Library Settings</Button>\n          </div>\n        ) : (\n          <div>\n            <Typography.Paragraph>\n              This will save the current panel into the selected library (<strong>{selectedFile?.name || fileId}</strong>).\n            </Typography.Paragraph>\n            <Input value={filename} onChange={(e) => setFilename(e.target.value)} placeholder=\"Optional filename\" />\n          </div>\n        )}\n      </div>\n    </Modal>\n  );\n}\n","import { useState, useRef, useMemo, useEffect, lazy, Suspense } from 'react';\nimport './ColorworkDesignerApp.css';\nimport { Layout, Typography, Button, Space, Card, Row, Col } from 'antd';\nimport { PlusOutlined, ThunderboltOutlined, BgColorsOutlined } from '@ant-design/icons';\nimport { garments } from '../../data/garments';\nimport { DriveAuthProvider } from './context/DriveAuthContext';\nimport { useDropdown } from '../../components/DropdownProvider';\nimport { useDispatch } from 'react-redux';\nimport { openLibrarySettingsModal } from '../../reducers/modal.reducer';\nimport LibraryOpenDialog from '../../components/LibraryOpenDialog';\nimport LibrarySaveDialog from '../../components/LibrarySaveDialog';\nimport { OpenModal, SaveAsModal } from '@/components/modals';\nimport { emitEvent } from '../../store/uiEventsSlice';\nimport ColorworkPanelEditor from '../../components/ColorworkPanelEditor';\n// Google sign-in now rendered by the page header; per-editor buttons removed\nimport PanelShapeCreator from './PanelShapeCreator';\n// Lazy-load the knitting designer and wizard to avoid circular import evaluation at module load time\nconst KnittingDesignerApp = lazy(() => import('../knitting-designer/KnittingDesignerApp'));\nconst WizardView = lazy(() => import('../knitting-designer/components/WizardView'));\nimport { Routes, Route, useNavigate, useLocation } from 'react-router-dom';\n\nconst { Title, Text } = Typography;\nconst { Content } = Layout;\n\n/**\n * Machine Knitting Panel Designer - Main application for creating and knitting panels\n * Integrates with existing garment shapes and colorwork patterns\n */\nconst ColorworkDesignerApp = () => {\n    // Lightweight local types for incremental work\n    const [savedPatterns, setSavedPatterns] = useState<any[]>([]);\n    const [currentProject, setCurrentProject] = useState<any | null>(null);\n    // removed local modal flow; navigation will be used instead\n    const [knittingStage, setKnittingStage] = useState<string>('settings'); // 'settings' or 'knitting'\n    const editorRef = useRef<any>(null);\n    // Cast the imported editor to any to avoid prop-type friction during the focused pass\n    const AnyColorworkPanelEditor: any = ColorworkPanelEditor;\n    const recentProjects = useMemo(() => ([\n        { id: 1, name: 'Raglan Sweater Front', garment: 'cozy-raglan-sweater', panel: 'Front', lastModified: '2 hours ago' },\n        { id: 2, name: 'Hat Crown', garment: 'seam-top-hat', panel: 'Hat', lastModified: '1 day ago' }\n    ]), []);\n\n    // Handle selecting a garment panel to knit\n    const handleKnitPanel = (garment: any, panelName: any, panelShape: any) => {\n        const project = {\n            id: Date.now(),\n            name: `${garment.title} - ${panelName}`,\n            garment: garment,\n            panelName: panelName,\n            panelShape: panelShape,\n            colorwork: null,\n            instructions: []\n        };\n            setCurrentProject(project);\n            // Navigate to the pattern-designer route so the Knitting Designer (and Wizard) are rendered.\n            // Pass the selected project in location.state so the editor can read it if needed.\n            navigate('colorwork-pattern-designer', { state: { project } });\n    };\n\n    // Removed unused handleNewProject function\n\n    const handleLoadProject = (project: any) => {\n        // Fix legacy projects that might be missing panelShape data\n        const fixedProject = fixLegacyProject(project);\n        setCurrentProject(fixedProject);\n        // Open the pattern creator route for the loaded project\n        navigate('colorwork-pattern-designer', { state: { project: fixedProject } });\n    };\n\n    const handleSaveProject = (projectData: any) => {\n        const updatedProject = {\n            ...currentProject,\n            ...projectData,\n            modified: new Date().toISOString()\n        };\n        \n        setSavedPatterns(prev => {\n            const existing = prev.find((p: any) => p.id === updatedProject.id);\n            if (existing) {\n                return prev.map((p: any) => p.id === updatedProject.id ? updatedProject : p);\n            } else {\n                return [...prev, updatedProject];\n            }\n        });\n        \n        setCurrentProject(updatedProject);\n    };\n\n    const navigate = useNavigate();\n    const location = useLocation();\n\n    // Helper function to fix legacy projects missing panelShape data\n    const fixLegacyProject = (project: any) => {\n        // If the project already has panelShape data, return it as-is\n        if (project.panelShape) {\n            return project;\n        }\n\n        // Try to reconstruct panelShape from garment data\n        if (project.garment && project.panelName && project.garment.shapes) {\n            const panelShape = project.garment.shapes[project.panelName];\n            if (panelShape) {\n                return {\n                    ...project,\n                    panelShape: panelShape\n                };\n            }\n        }\n\n        // If we can't fix it, return the original project\n        // The ColorworkPanelEditor will fall back to the default shape\n        console.warn('Could not fix legacy project - missing garment or panel data:', project);\n        return project;\n    };\n\n    const renderHomeView = () => (\n        <div className=\"colorwork-home\">\n            <div className=\"home-header\">\n                <Title level={1}>Machine Knitting Panel Designer</Title>\n                <Text type=\"secondary\" style={{ fontSize: '16px' }}>\n                    Create panel shapes, design colorwork patterns, and generate complete machine knitting instructions.\n                </Text>\n            </div>\n\n            <Row gutter={[24, 24]} style={{ marginTop: 40 }}>\n                <Col xs={24} md={12} lg={8}>\n                    <Card\n                        hoverable\n                        className=\"action-card\"\n                        onClick={() => navigate('panel-shape-creator')}\n                        style={{ height: '200px', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}\n                    >\n                        <div style={{ textAlign: 'center' }}>\n                            <PlusOutlined style={{ fontSize: '48px', color: '#1890ff', marginBottom: '16px' }} />\n                            <Title level={4}>Create Panel Shape</Title>\n                            <Text type=\"secondary\">Design custom shapes for your knitting project</Text>\n                        </div>\n                    </Card>\n                </Col>\n                \n                <Col xs={24} md={12} lg={8}>\n                    <Card\n                        hoverable\n                        className=\"action-card\"\n                        onClick={() => navigate('colorwork-pattern-designer')}\n                        style={{ height: '200px', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}\n                    >\n                        <div style={{ textAlign: 'center' }}>\n                            <BgColorsOutlined style={{ fontSize: '48px', color: '#52c41a', marginBottom: '16px' }} />\n                            <Title level={4}>Create Colorwork Pattern</Title>\n                            <Text type=\"secondary\">Design custom colorwork grids and charts</Text>\n                        </div>\n                    </Card>\n                </Col>\n\n                <Col xs={24} md={12} lg={8}>\n                    <Card\n                        hoverable\n                        className=\"action-card\"\n                        onClick={() => navigate('pattern-wizard')}\n                        style={{ height: '200px', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}\n                    >\n                        <div style={{ textAlign: 'center' }}>\n                            <ThunderboltOutlined style={{ fontSize: '48px', color: '#faad14', marginBottom: '16px' }} />\n                            <Title level={4}>Make a Knitting Pattern</Title>\n                            <Text type=\"secondary\">Create a plan to knit your project</Text>\n                        </div>\n                    </Card>\n                </Col>\n            </Row>\n\n            {/* Recent Projects Section */}\n            {(recentProjects.length > 0 || savedPatterns.length > 0) && (\n                <div style={{ marginTop: 40 }}>\n                    <Title level={2}>Recent Projects</Title>\n                    <Row gutter={[16, 16]}>\n                        <Col xs={24}>\n                            {recentProjects.map((project: any) => (\n                                <Card \n                                    key={project.id}\n                                    hoverable\n                                    size=\"small\"\n                                    title={project.name}\n                                    extra={<Button type=\"link\" onClick={() => {}}>Resume</Button>}\n                                    style={{ marginBottom: '12px', cursor: 'pointer' }}\n                                    onClick={() => {}}\n                                >\n                                    <Text type=\"secondary\">\n                                        Last modified: {project.lastModified}\n                                    </Text>\n\n                                </Card>\n                            ))}\n                            {savedPatterns.map((pattern: any) => (\n                                <Card \n                                    key={pattern.id}\n                                    hoverable\n                                    size=\"small\"\n                                    title={pattern.name}\n                                    extra={<Button type=\"link\" onClick={() => handleLoadProject(pattern)}>Open</Button>}\n                                    style={{ marginBottom: '12px', cursor: 'pointer' }}\n                                    onClick={() => handleLoadProject(pattern)}\n                                >\n                                    <Text type=\"secondary\">\n                                        Modified: {new Date(pattern.modified || pattern.created).toLocaleDateString()}\n                                    </Text>\n                                </Card>\n                            ))}\n                        </Col>\n                    </Row>\n                </div>\n            )}\n\n            {/* Garment selection modal removed - navigation to colorwork-pattern-designer route now used */}\n        </div>\n    );\n\n    const renderEditorView = () => (\n        <div className=\"colorwork-editor-wrapper\">\n            <div className=\"editor-toolbar\">\n                <Title level={3} style={{ margin: 0, flex: 1 }}>\n                    Knitting Options for {currentProject?.name || 'Untitled Project'}\n                </Title>\n                {knittingStage === 'settings' && (\n                    <Button \n                        type=\"primary\" \n                        size=\"large\"\n                        onClick={() => {\n                            if (editorRef.current && editorRef.current.startKnitting) {\n                                editorRef.current.startKnitting();\n                            }\n                        }}\n                    >\n                        Start Knitting →\n                    </Button>\n                )}\n            </div>\n            \n                <AnyColorworkPanelEditor\n                ref={editorRef}\n                initialPanel={currentProject?.panel}\n                initialColorwork={currentProject?.colorwork}\n                project={currentProject}\n                stage={knittingStage}\n                onSave={handleSaveProject}\n                    onStageChange={(stage: any) => setKnittingStage(stage)}\n            />\n        </div>\n    );\n\n    // Register header dropdown items for Colorwork Designer based on current sub-route\n    const { setMenuItems } = useDropdown();\n    const dispatch = useDispatch();\n    const [showOpenDialog, setShowOpenDialog] = useState(false);\n    const [showSaveDialog, setShowSaveDialog] = useState(false);\n    const [showPatternOpen, setShowPatternOpen] = useState(false);\n    const [showPatternSaveAs, setShowPatternSaveAs] = useState(false);\n    const [currentPatternData, setCurrentPatternData] = useState<any>(null);\n\n    // Listen for pattern data from KnittingDesignerApp\n    useEffect(() => {\n        const handlePatternData = (event: any) => {\n            const { pattern, gridSize, colors } = event.detail;\n            setCurrentPatternData({ pattern, gridSize, colors });\n            setShowPatternSaveAs(true);\n        };\n\n        window.addEventListener('colorwork:pattern-data', handlePatternData);\n        return () => window.removeEventListener('colorwork:pattern-data', handlePatternData);\n    }, []);\n\n    useEffect(() => {\n        const path = location.pathname || '';\n        let items: any[] = [];\n        if (path.includes('panel-shape-creator')) {\n            // PanelShapeCreator now handles its own menu items via DropdownProvider\n            // Leave items empty to avoid conflicts\n            items = [];\n        } else if (path.includes('colorwork-pattern-designer')) {\n            items = [\n                {\n                    key: 'colorwork-pattern-save',\n                    label: 'Save Pattern',\n                    onClick: () => {\n                        // Request pattern data from KnittingDesignerApp\n                        window.dispatchEvent(new Event('colorwork:request-pattern-data'));\n                    }\n                },\n                {\n                    key: 'colorwork-pattern-open',\n                    label: 'Open Pattern',\n                    onClick: () => setShowPatternOpen(true)\n                }\n            ];\n        } else {\n            // Default header actions when on the colorwork home\n            items = [\n                {\n                    key: 'colorwork-open-home',\n                    label: 'Open...',\n                    onClick: () => dispatch(openLibrarySettingsModal('panels', { intent: 'open' }))\n                }\n            ];\n        }\n\n        setMenuItems(items);\n        return () => setMenuItems([]);\n    }, [setMenuItems, location.pathname, currentProject, dispatch]);\n\n    return (\n        <Layout className=\"colorwork-designer-app\">\n            <DriveAuthProvider>\n                <Content>\n                    {/* Simple library dialogs for this app. They emit uiEvents when a file is chosen or saved */}\n                    <LibraryOpenDialog visible={showOpenDialog} onClose={() => setShowOpenDialog(false)} onOpen={(lib, fileRef) => {\n                        dispatch(emitEvent({ type: 'colorwork:library-opened', payload: { library: lib, fileRef } }));\n                        setShowOpenDialog(false);\n                    }} />\n                    <LibrarySaveDialog visible={showSaveDialog} onClose={() => setShowSaveDialog(false)} onSave={(result) => {\n                        // Emit a richer saved event containing the saved fileRef/entry when available\n                        dispatch(emitEvent({ type: 'colorwork:library-saved', payload: result || {} }));\n                        setShowSaveDialog(false);\n                    }} fileId={null} libraryData={currentProject} />\n\n                    <Routes>\n                        <Route path=\"/\" element={renderHomeView()} />\n                        <Route path=\"panel-shape-creator\" element={(\n                            <div className=\"panel-shape-creator\" style={{ height: '100vh', display: 'flex', flexDirection: 'column' }}>\n                                <div className=\"editor-toolbar\" style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '8px 16px', borderBottom: '1px solid #f0f0f0' }}>\n                                    <Title level={3} style={{ margin: 0, flex: 1 }}>Panel Shape Creator</Title>\n                                </div>\n                                <div style={{ flex: 1, minHeight: 0 }}>\n                                    <PanelShapeCreator />\n                                </div>\n                            </div>\n                        )} />\n                        <Route path=\"colorwork-pattern-designer\" element={(\n                            <div className=\"colorwork-pattern-designer\" style={{ display: 'flex', flexDirection: 'column' }}>\n                                <div className=\"editor-toolbar\" style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '8px 16px', borderBottom: '1px solid #f0f0f0' }}>\n                                    <Title level={3} style={{ margin: 0, flex: 1 }}>Colorwork Pattern Designer</Title>\n                                </div>\n                                <div style={{ flex: 1, minHeight: 0 }}>\n                                            <KnittingDesignerApp />\n                                        </div>\n                                    </div>\n                                )} />\n                                <Route path=\"pattern-wizard\" element={(\n                                    <div className=\"pattern-wizard\" style={{ display: 'flex', flexDirection: 'column' }}>\n                                        <div className=\"editor-toolbar\" style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '8px 16px', borderBottom: '1px solid #f0f0f0' }}>\n                                            <Title level={3} style={{ margin: 0, flex: 1 }}>Pattern Wizard</Title>\n                                        </div>\n                                        <div style={{ flex: 1, minHeight: 0 }}>\n                                            <WizardView />\n                                        </div>\n                                    </div>\n                                )} />\n                    </Routes>\n\n                    {/* Open Pattern modal for Colorwork Pattern Creator */}\n                    <OpenModal\n                        visible={showPatternOpen}\n                        jsonKey=\"colorworkPatterns\"\n                        settingsKey=\"panels\"\n                        displayLabel=\"Pattern\"\n                        onOpen={(pattern) => {\n                            try {\n                                // Dispatch a UI event so other parts of the app can react\n                                dispatch(emitEvent({ type: 'colorwork:pattern-opened', payload: pattern }));\n                            } catch (e) { /* swallow */ }\n                            setShowPatternOpen(false);\n                        }}\n                        onClose={() => setShowPatternOpen(false)}\n                    />\n\n                    {/* Save Pattern modal for Colorwork Pattern Creator */}\n                    <SaveAsModal\n                        visible={showPatternSaveAs}\n                        jsonKey=\"colorworkPatterns\"\n                        settingsKey=\"panels\"\n                        displayLabel=\"Pattern\"\n                        entityData={currentPatternData}\n                        onSave={async (name: string, patternData: any) => {\n                            console.log(`Pattern \"${name}\" saved successfully`);\n                            // The SaveAsModal already saved to Google Drive\n                        }}\n                        onClose={() => {\n                            setShowPatternSaveAs(false);\n                            setCurrentPatternData(null);\n                        }}\n                    />\n                </Content>\n            </DriveAuthProvider>\n        </Layout>\n    );\n};\n\nexport default ColorworkDesignerApp;\n"],"file":"static/js/ColorworkDesignerApp-KXLHb1Ih.js"}