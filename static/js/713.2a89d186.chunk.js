"use strict";(self.webpackChunkhobbies=self.webpackChunkhobbies||[]).push([[713],{9174:(e,n,t)=>{t.r(n),t.d(n,{default:()=>R});var s=t(9379),i=t(5043),o=t(9456),l=t(2817),r=t(9620),a=t(3204);var c=t(7341),d=t(579);const u=e=>{let{line:n,onSave:t,onCancel:s}=e;const[o,l]=(0,i.useState)(n||""),r=(0,i.useRef)(null);(0,i.useEffect)((()=>{r.current&&r.current.focus()}),[]);const a=()=>{t(o)};return(0,d.jsxs)("div",{className:"lyric-line-editor",children:[(0,d.jsx)("input",{ref:r,type:"text",value:o,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key?a():"Escape"===e.key&&s()},placeholder:"Enter lyrics with [Chord] notation...",className:"lyric-input"}),(0,d.jsxs)("div",{className:"editor-controls",children:[(0,d.jsx)("button",{onClick:a,className:"save-button",children:"Save"}),(0,d.jsx)("button",{onClick:s,className:"cancel-button",children:"Cancel"})]})]})};var g=t(1686),p=t(2625),h=t(647),m=t(9324),x=t(172),y=t(3585),f=t(1648),b=t(1024);const v=e=>{let{line:n,index:t,id:i,editingLineIndex:o,editingEnabled:l,hoveredLineIndex:r,setHoveredLineIndex:c,handleEditLine:p,handleInsertAfter:h,handleDeleteLine:m,handleSaveLine:x,handleCancelEdit:y,renderLyricLine:v,isThisLinePending:j=!1,isDragDisabled:w=!1,isPendingDelete:C=!1,isAddingLine:S=!1,isPendingSave:A=!1}=e;const{attributes:N,listeners:k,setNodeRef:D,transform:E,transition:G,isDragging:I}=(0,f.gl)({id:i,disabled:w}),F={transform:b.Ks.Transform.toString(E),transition:G,opacity:I?.5:C?.6:1,position:"relative",backgroundColor:C?"#f5f5f5":"transparent",color:C?"#999":"inherit",pointerEvents:C?"none":"auto"};return(0,d.jsx)("div",{ref:D,style:F,className:"lyric-line",onMouseEnter:()=>c(t),onMouseLeave:()=>c(null),children:o===t&&!S&&l?(0,d.jsx)(u,{line:n,onSave:e=>x(e,t),onCancel:y}):(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,d.jsx)("div",{className:"lyric-content",style:{flex:1},children:v(n)}),A&&(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"4px",color:"#1890ff"},children:[(0,d.jsx)(g.A,{size:"small"}),(0,d.jsx)("span",{style:{fontSize:"12px"},children:"Saving..."})]}),C&&(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"4px",color:"#cf1322"},children:[(0,d.jsx)(g.A,{size:"small"}),(0,d.jsx)("span",{style:{fontSize:"12px"},children:"Deleting..."})]}),r===t&&l&&!C&&(0,d.jsxs)("div",{className:"lyric-controls",style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,d.jsx)("button",{className:"control-button edit",onClick:e=>{e.stopPropagation(),p(t)},style:{padding:"4px 6px",border:"1px solid #ccc",backgroundColor:"#f9f9f9",borderRadius:"3px",cursor:"pointer",fontSize:"12px"},title:"Edit this line",children:(0,d.jsx)(a.Mbp,{})}),(0,d.jsx)("button",{className:"control-button insert",onClick:e=>{e.stopPropagation(),h(t)},style:{padding:"4px 6px",border:"1px solid #ccc",backgroundColor:"#f9f9f9",borderRadius:"3px",cursor:"pointer",fontSize:"12px",color:"#5cb85c"},title:"Insert new line after this line",children:(0,d.jsx)(a.OiG,{})}),(0,d.jsx)("button",{className:"control-button delete",onClick:e=>{e.stopPropagation(),m(t)},style:{padding:"4px 6px",border:"1px solid #ccc",backgroundColor:"#f9f9f9",borderRadius:"3px",cursor:"pointer",fontSize:"12px",color:"#d9534f"},title:"Delete this line",children:(0,d.jsx)(a.qbC,{})}),(0,d.jsx)("div",(0,s.A)((0,s.A)((0,s.A)({},w?{}:N),w?{}:k),{},{className:"drag-handle",style:{padding:"4px 6px",border:"1px solid #ddd",backgroundColor:w?"#e9e9e9":"#f0f0f0",borderRadius:"3px",cursor:w?"not-allowed":"grab",fontSize:"12px",color:w?"#999":"#666",display:"flex",alignItems:"center",transition:"all 0.2s ease",boxShadow:w?"none":"0 1px 2px rgba(0,0,0,0.1)",opacity:w?.6:1},onMouseDown:w?void 0:e=>e.currentTarget.style.cursor="grabbing",onMouseUp:w?void 0:e=>e.currentTarget.style.cursor="grab",title:w?"Drag disabled during update":"Drag to reorder",children:j?(0,d.jsx)(g.A,{size:"small"}):(0,d.jsx)(a.WhN,{})}))]})]})})},j=e=>{let{song:n,onPinChord:t,onUpdateSong:b,artist:j,editingEnabled:w=!0}=e;const{message:C,modal:S}=p.A.useApp(),[A,N]=(0,i.useState)(null),[k,D]=(0,i.useState)(!1),[E,G]=(0,i.useState)(null),[I,F]=(0,i.useState)(null),[T,L]=(0,i.useState)(0),[z,P]=(0,i.useState)(!1),[M,R]=(0,i.useState)(!1),[O,B]=(0,i.useState)(""),[_,U]=(0,i.useState)(new Set),[H,W]=(0,i.useState)(null),[q,J]=(0,i.useState)(null),[Y,V]=(0,i.useState)(null),[$,K]=(0,i.useState)(new Set),[X,Q]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)(!1),[ne,te]=(0,i.useState)(!1),[se,ie]=(0,i.useState)(!1),[oe,le]=(0,i.useState)(!1),[re,ae]=(0,i.useState)(0),ce=(0,o.wA)(),de=(0,o.d4)((e=>e.chords.currentInstrument)),ue=(0,o.d4)((e=>{var t;return(null===(t=e.chords.transposeBy)||void 0===t?void 0:t[n.title])||0})),ge=(0,o.d4)((e=>e.chords.chordFingerings)),pe=(0,o.d4)((e=>e.songs.isGoogleDriveConnected)),he=(0,y.FR)((0,y.MS)(y.AN),(0,y.MS)(y.uN,{coordinateGetter:f.JR})),me=e=>{const n=/\[(.*?)\]/g,t=[];return null===e||void 0===e||e.forEach((e=>{let s;for(;null!==(s=n.exec(e));)t.includes(s[1])||t.push(s[1])})),t},xe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ye={Db:"C#",Eb:"D#",Gb:"F#",Ab:"G#",Bb:"A#"};function fe(e,n){if(e.includes("/")){const[t,s]=e.split("/"),i=fe(t,n),o=fe(s,n);return"".concat(i,"/").concat(o)}const t=e.match(/^([A-G][b#]?)(.*)$/);if(!t)return e;let[s,i,o]=t;ye[i]&&(i=ye[i]);let l=xe.indexOf(i);return-1===l?e:xe[(l+n+12)%12]+o}const be=Array.isArray(n.lyrics)?n.lyrics:"string"===typeof n.lyrics&&n.lyrics?n.lyrics.split("\n"):[],ve=(n.chords||me(be)).map((e=>0!==T?fe(e,T):e)),je=e=>{N(e),D(!1)},we=e=>{Z||$.size>0?C.warning("Please wait for current operation to complete before inserting a new line."):(D(!0),G(e),N(-1===e?0:e+1))},Ce=async(e,t)=>{const i=[...be];if(k){Q(!0),ee(!0);const t=null!==A&&A<=be.length?A:i.length;i.splice(t,0,e),J(i),U((e=>new Set([...e,t]))),N(null),D(!1),b((0,s.A)((0,s.A)({},n),{},{lyrics:i})).then((()=>{C.success("Line added successfully!"),J(null),Q(!1),ee(!1),U((e=>{const n=new Set(e);return n.delete(t),n})),N(null),D(!1),G(null)})).catch((e=>{console.error("Failed to add line:",e),C.error("Failed to add new line. Please try again."),J(null),Q(!1),ee(!1),U((e=>{const n=new Set(e);return n.delete(t),n})),D(!0),N(null),G(null)}))}else ee(!0),U((e=>new Set([...e,t]))),i[t]=e,J(i),N(null),b((0,s.A)((0,s.A)({},n),{},{lyrics:i})).then((()=>{C.success("Line updated successfully!"),J(null),ee(!1),U((e=>{const n=new Set(e);return n.delete(t),n}))})).catch((e=>{console.error("Failed to update line:",e),C.error("Failed to update line. Please try again."),J(null),ee(!1),U((e=>{const n=new Set(e);return n.delete(t),n})),N(t)}))},Se=()=>{N(null),D(!1),G(null)},Ae=async e=>{if(Z||$.has(e))return void C.warning("Please wait for current operation to complete before deleting this line.");ee(!0),K((n=>new Set([...n,e])));const t=[...be];t.splice(e,1),J(t);try{await b((0,s.A)((0,s.A)({},n),{},{lyrics:t})),C.success("Line deleted successfully!"),J(null),ee(!1),K((n=>{const t=new Set(n);return t.delete(e),t}))}catch(i){console.error("Failed to delete line:",i),C.error("Failed to delete line. Please try again."),J(null),ee(!1),K((n=>{const t=new Set(n);return t.delete(e),t}))}},Ne=async()=>{le(!0);try{var e;await ce((0,r.B1)({artistName:j.name,albumTitle:null===(e=n.album)||void 0===e?void 0:e.title,songTitle:n.title,isGoogleDriveConnected:pe})).unwrap(),C.success("Song deleted successfully!"),ce((0,r.uJ)())}catch(t){console.error("Failed to delete song:",t),(e=>{if(!e)return!1;const n=e.message||e||"";return["User not signed in to Google Drive","Expected OAuth 2 access token","login cookie or other valid authentication credential","Invalid Credentials","Authentication failed","unauthorized_client","invalid_token","expired_token","access_denied","token_expired","Request had invalid authentication credentials"].some((e=>n.toLowerCase().includes(e.toLowerCase())))})(t)?(ce((0,r.oH)(!1)),ce((0,r.iA)(null)),C.error("Your Google Drive session has expired. Please sign in again to delete songs.")):C.error(t.message||"Failed to delete song. Please try again.")}finally{le(!1),ae(0)}},ke=e=>{const n=/\[(.*?)\]/g,i=[];let o,l=e;for(;null!==(o=n.exec(e));)i.push({chord:o[1],position:o.index,length:o[0].length});l=l.replace(/\[(.*?)\]/g,"");const r=i.map(((e,n)=>{let t=0;for(let s=0;s<n;s++)t+=i[s].length;const o=0!==T?fe(e.chord,T):e.chord;return(0,s.A)((0,s.A)({},e),{},{chord:o,position:e.position-t})}));return(0,d.jsxs)("div",{className:"lyric-line-with-chords",children:[(0,d.jsx)("div",{className:"chord-labels",children:r.map(((e,n)=>(0,d.jsx)("span",{className:"chord-label",style:{left:"".concat(e.position,"ch")},onClick:()=>t(e.chord),children:e.chord},"chord-".concat(n))))}),(0,d.jsx)("div",{className:"lyric-text-only",children:l})]})};i.useEffect((()=>{L(ue),P(!1)}),[n.title]);return(0,d.jsxs)("div",{className:"song-detail",children:[(0,d.jsxs)("div",{className:"chords-section",children:[(0,d.jsxs)("div",{className:"chords-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"1rem"},children:[(0,d.jsx)("h3",{style:{margin:0},children:n.title}),(0,d.jsx)("i",{style:{margin:0},children:j.name})]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flex:1,justifyContent:"center"},children:[(0,d.jsx)("button",{className:"transpose-btn",title:"Transpose Down",onClick:()=>{L((e=>e-1)),P(!0),ce((0,l.jd)(n.title))},style:{fontSize:"1.2em",padding:"0.2em 0.6em"},children:"-"}),(0,d.jsxs)("span",{style:{minWidth:40,textAlign:"center"},children:["Transpose: ",T>0?"+".concat(T):T," semitones"]}),(0,d.jsx)("button",{className:"transpose-btn",title:"Transpose Up",onClick:()=>{L((e=>e+1)),P(!0),ce((0,l.o5)(n.title))},style:{fontSize:"1.2em",padding:"0.2em 0.6em"},children:"+"}),(0,d.jsxs)("button",{className:"save-transpose-btn",onClick:async()=>{te(!0);try{const e=be.map((e=>e.replace(/\[([^\]]+)\]/g,((e,n)=>{const t=fe(n,T);return"[".concat(t,"]")})))),t=(0,s.A)((0,s.A)({},n),{},{lyrics:e,chords:me(e),chordFingerings:ge});await b(t),L(0),P(!1),C.success("Transposed lyrics saved successfully!")}catch(e){console.error("Failed to save transposed lyrics:",e),C.error("Failed to save transposed lyrics. Please try again.")}finally{te(!1)}},disabled:!z||!w||ne,style:{marginLeft:"1em",padding:"0.2em 0.8em",opacity:z&&w&&!ne?1:.5,display:"flex",alignItems:"center",gap:"0.5em"},children:[ne&&(0,d.jsx)(g.A,{size:"small"}),"Save Transposed Lyrics"]})]}),(0,d.jsxs)("div",{className:"instrument-selector",style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[(0,d.jsx)("label",{htmlFor:"instrument-select",style:{marginRight:0},children:"Instrument:"}),(0,d.jsxs)("select",{id:"instrument-select",value:de,onChange:e=>ce((0,l.wE)(e.target.value)),style:{minWidth:120},children:[(0,d.jsx)("option",{value:"ukulele",children:"Ukulele"}),(0,d.jsx)("option",{value:"guitar",children:"Guitar"}),(0,d.jsx)("option",{value:"piano",children:"Piano"}),(0,d.jsx)("option",{value:"bassGuitar",children:"Bass Guitar"}),(0,d.jsx)("option",{value:"bassUkulele",children:"Bass Ukulele"}),(0,d.jsx)("option",{value:"baritoneUkulele",children:"Baritone Ukulele"})]})]})]}),(0,d.jsx)("div",{className:"chord-container",children:ve.map((e=>(0,d.jsx)("div",{className:"chord-item",onClick:()=>t(e),children:(0,d.jsx)(c.A,{chord:e,instrument:de})},e)))})]}),(0,d.jsx)("div",{className:"lyrics-section",children:(0,d.jsxs)("div",{className:"lyrics-container",children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"1rem",justifyContent:"space-between"},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",gap:"1rem"},children:[(0,d.jsx)("h3",{style:{margin:0},children:n.title}),(0,d.jsx)("i",{style:{margin:0},children:j.name})]}),w&&!M&&(0,d.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,d.jsxs)("button",{className:"edit-whole-song-btn",onClick:()=>{B(be.join("\n")),R(!0)},style:{padding:"0.5em 1em",fontSize:"0.9em",backgroundColor:"#4285f4",color:"white",border:"1px solid #3367d6",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5em",transition:"background-color 0.2s ease"},onMouseEnter:e=>e.target.style.backgroundColor="#3367d6",onMouseLeave:e=>e.target.style.backgroundColor="#4285f4",children:[(0,d.jsx)(a.uO9,{})," Edit Whole Song"]}),(0,d.jsx)(h.A,{title:(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{children:['Delete "',n.title,'"?']}),(0,d.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:"This action cannot be undone."})]}),description:(()=>{var e;return(0,d.jsx)("div",{style:{minWidth:"200px"},children:(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Artist:"})," ",j.name,(0,d.jsx)("br",{}),(0,d.jsx)("strong",{children:"Album:"})," ",null===(e=n.album)||void 0===e?void 0:e.title,(0,d.jsx)("br",{}),(0,d.jsx)("strong",{children:"Song:"})," ",n.title]})})})(),onConfirm:()=>{Ne()},onOpenChange:e=>{if(e){ae(3);const e=setInterval((()=>{ae((n=>n<=.1?(clearInterval(e),0):Math.max(0,n-.1)))}),100)}else ae(0)},okText:re>0?(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",position:"relative"},children:[(0,d.jsxs)(m.A,{style:{position:"relative",display:"inline-flex",alignItems:"center"},children:[(0,d.jsx)(x.A,{variant:"determinate",value:(3-re)/3*100,size:20,thickness:8,style:{color:"#dc3545"}}),(0,d.jsx)(m.A,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#dc3545",fontWeight:"bold",fontSize:"10px"},children:(re+1).toFixed()})]}),"Please wait..."]}):oe?(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,d.jsx)(g.A,{size:"small"}),"Deleting..."]}):"Delete",cancelText:oe?null:"Cancel",okType:"danger",showCancel:!oe,okButtonProps:{disabled:re>0||oe},placement:"bottomRight",children:(0,d.jsxs)("button",{className:"delete-song-btn",style:{padding:"0.5em 1em",fontSize:"0.9em",backgroundColor:"#dc3545",color:"white",border:"1px solid #c82333",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5em",transition:"background-color 0.2s ease"},onMouseEnter:e=>e.target.style.backgroundColor="#c82333",onMouseLeave:e=>e.target.style.backgroundColor="#dc3545",children:[(0,d.jsx)(a.qbC,{})," Delete Song"]})})]}),M&&(0,d.jsxs)("button",{onClick:()=>{try{const e=function(e){const n=e.replace(/\[.*?\]/g,"").split("\n"),t=[];let s=0;for(;s<n.length;){let e=n[s].trim();if(/^\[.*?(?::.+)?\]$/.test(e)){0!==t.length&&""===t[t.length-1]||t.push(""),s++;continue}if(!e){0!==t.length&&""===t[t.length-1]||t.push(""),s++;continue}e=e.replace(/N\.C\./g,"    ");const i=/[A-G][#b]?(?:maj|min|m|sus|aug|dim|add)?[0-9]*(?:[#b][0-9]+)*(?:\/[A-G][#b]?)?/g,o=e.match(i)||[],l=e.replace(i,"").trim();if(o.length>0&&(""===l||/^\s*$/.test(l))){const i=/[A-G][#b]?(?:maj|min|m|sus|aug|dim|add)?[0-9]*(?:[#b][0-9]+)*(?:\/[A-G][#b]?)?/g,o=[];let l;const r=e.replace(/\s+/g," ").trim().match(/^[A-G][#b]?(?:maj|min|m|sus|aug|dim|add)?[0-9]*(?:[#b][0-9]+)*(?:\/[A-G][#b]?)?$/);if(r){let e=s+1;for(;e<n.length&&!n[e].trim();)e++;if(e<n.length){t.push("[".concat(r[0],"]").concat(n[e].trim())),s=e+1;continue}}for(;null!==(l=i.exec(e));)o.push({chord:l[0],position:l.index});let a=s+1;for(;a<n.length&&!n[a].trim();)a++;if(a<n.length){const e=n[a].trim(),i=e.split(""),l=[];o.forEach((n=>{let{chord:t,position:s}=n,i=s;for(;i<e.length&&/\s/.test(e[i]);)i++;l.push({pos:i,text:"[".concat(t,"]")})})),l.sort(((e,n)=>n.pos-e.pos)),l.forEach((e=>{let{pos:n,text:t}=e;i.splice(n,0,t)})),t.push(i.join("")),s=a+1}else t.push("[".concat(e.trim(),"]")),s++}else t.push(e),s++}for(;""===t[0];)t.shift();for(;""===t[t.length-1];)t.pop();return t.join("\n")}(O);B(e),C.success("Lyrics converted successfully!")}catch(e){console.error("Error converting lyrics:",e),C.error("Failed to convert lyrics format. Please check your input.")}},style:{padding:"0.5em 1em",fontSize:"0.9em",backgroundColor:"#5C6BC0",color:"white",border:"1px solid #3F51B5",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5em",marginLeft:"10px",transition:"background-color 0.2s ease"},onMouseEnter:e=>e.target.style.backgroundColor="#3F51B5",onMouseLeave:e=>e.target.style.backgroundColor="#5C6BC0",children:[(0,d.jsx)(a.Y4c,{})," Convert from Clipboard Format"]})]}),M?(0,d.jsxs)("div",{className:"whole-song-editor",style:{marginTop:"1rem"},children:[(0,d.jsx)("textarea",{value:O,onChange:e=>B(e.target.value),rows:15,style:{width:"100%",fontFamily:"monospace",fontSize:"14px",padding:"10px",border:"1px solid #ccc",borderRadius:"4px"},placeholder:"Enter lyrics with [Chord] notation..."}),(0,d.jsxs)("div",{style:{marginTop:"10px",display:"flex",gap:"10px"},children:[(0,d.jsxs)("button",{onClick:async()=>{ie(!0);try{const e=O.split("\n").filter((e=>""!==e.trim()));await b((0,s.A)((0,s.A)({},n),{},{lyrics:e,chords:me(e)})),R(!1),C.success("Song lyrics saved successfully!")}catch(e){console.error("Failed to save whole song:",e),C.error("Failed to save song. Please try again.")}finally{ie(!1)}},disabled:se,style:{padding:"0.5em 1em",backgroundColor:se?"#ccc":"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:se?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5em"},children:[se&&(0,d.jsx)(g.A,{size:"small"}),se?"Saving...":"Save"]}),(0,d.jsx)("button",{onClick:()=>{R(!1),B("")},style:{padding:"0.5em 1em",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Cancel"})]})]}):(0,d.jsxs)(y.Mp,{sensors:he,collisionDetection:y.fp,onDragEnd:async e=>{const{active:t,over:i}=e;if(t.id!==i.id){ee(!0);const e=be.findIndex(((e,n)=>n.toString()===t.id)),o=be.findIndex(((e,n)=>n.toString()===i.id)),l=(0,f.be)(be,e,o);J(l),V(o),b((0,s.A)((0,s.A)({},n),{},{lyrics:l})).then((()=>{C.success("Lines reordered successfully!"),J(null),ee(!1),V(null)})).catch((e=>{console.error("Failed to reorder lines:",e),C.error("Failed to reorder lines. Please try again."),J(null),ee(!1),V(null)}))}},children:[(0,d.jsx)(f.gB,{items:(q||be).map(((e,n)=>n.toString())),strategy:f._G,children:(q||be)&&(q||be).map(((e,n)=>(0,d.jsxs)("div",{children:[(0,d.jsx)(v,{id:n.toString(),line:e,index:n,editingLineIndex:A,editingEnabled:w,hoveredLineIndex:I,setHoveredLineIndex:F,handleEditLine:je,handleInsertAfter:we,handleDeleteLine:Ae,handleSaveLine:Ce,handleCancelEdit:Se,renderLyricLine:ke,isThisLinePending:Y===n,isDragDisabled:null!==H||$.has(n)||_.has(n),isPendingDelete:$.has(n),isPendingSave:_.has(n),isAddingLine:k}),k&&E===n&&w&&(0,d.jsx)(u,{line:"",onSave:e=>Ce(e,n+1),onCancel:Se})]},n)))}),w&&0===be.length&&!k&&(0,d.jsxs)("button",{className:"add-lyric-button",onClick:()=>we(-1),style:{padding:"10px 20px",border:"2px dashed #ccc",backgroundColor:"transparent",borderRadius:"8px",cursor:"pointer",fontSize:"16px",color:"#666",display:"flex",alignItems:"center",gap:"8px",margin:"20px 0",width:"100%",justifyContent:"center"},children:[(0,d.jsx)(a.OiG,{})," Add First Line"]}),k&&-1===E&&w&&(0,d.jsx)(u,{line:"",onSave:e=>Ce(e,0),onCancel:Se})]})]})})]})},w=e=>(0,d.jsx)(p.A,{children:(0,d.jsx)(j,(0,s.A)({},e))});var C=t(7945),S=t.n(C);t(7589);const A=function(e){let{library:n,selectedSong:t,editingEnabled:s,onSelectSong:l}=e;const a=(0,o.wA)(),c=(0,o.d4)(r.zh),u=(0,i.useMemo)((()=>{if(!n||!n.artists)return{name:"Music Library",isOpen:!0,children:[]};const e={name:"Music Library",isOpen:!0,children:[]};return n.artists.forEach((n=>{const s={name:n.name,isOpen:!0,type:"artist",children:[]};n.albums&&n.albums.forEach((e=>{const i={name:e.title,isOpen:!0,type:"album",artistName:n.name,children:[]};e.songs&&e.songs.forEach((s=>{var o,l;const r=t&&t.title===s.title&&(null===(o=t.artist)||void 0===o?void 0:o.name)===n.name&&(null===(l=t.album)||void 0===l?void 0:l.title)===e.title;i.children.push({name:s.title,type:"song",artistName:n.name,albumTitle:e.title,songData:s,isSelected:r})})),s.children.push(i)})),e.children.push(s)})),e}),[n,t]);return(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{children:"Song Library"}),(0,d.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"10px",maxHeight:"500px",overflowY:"auto"},children:[(0,d.jsx)("style",{children:'\n          .FolderTree .TreeNode[data-selected="true"] {\n            background-color: #e6f7ff !important;\n            border-left: 3px solid #1890ff !important;\n            padding-left: 7px !important;\n          }\n          .FolderTree .TreeNode[data-selected="true"] .EditableName .displayName {\n            color: #1890ff !important;\n            font-weight: 500 !important;\n          }\n        '}),(0,d.jsx)(S(),{data:u,onChange:(e,n)=>{console.log("Tree state changed:",{newTreeState:e,event:n})},onNameClick:e=>{let{defaultOnClick:n,nodeData:t}=e;console.log("Name clicked:",{nodeData:t}),t&&"song"===t.type&&l?(console.log("Selecting song:",t.songData.title),l(t.songData,t.artistName,t.albumTitle)):n()},onNameChange:s?async(e,n,t)=>{if(s&&n.trim())try{"artist"===t.type?await a((0,r.lF)({oldArtistName:e,newArtistName:n.trim(),isGoogleDriveConnected:c})).unwrap():"album"===t.type?await a((0,r.re)({artistName:t.artistName,oldAlbumTitle:e,newAlbumTitle:n.trim(),isGoogleDriveConnected:c})).unwrap():"song"===t.type&&await a((0,r.Bg)({artistName:t.artistName,albumTitle:t.albumTitle,songTitle:e,updatedSongData:{title:n.trim()},isGoogleDriveConnected:c})).unwrap()}catch(i){console.error("Failed to update:",i)}}:void 0,onAddNode:s?async(e,n)=>{if(s&&e.trim())try{n?"artist"===n.type?await a((0,r.Xu)({artistName:n.name,albumTitle:e.trim(),isGoogleDriveConnected:c})).unwrap():"album"===n.type&&await a((0,r.X1)({artistName:n.artistName,albumTitle:n.name,songData:{title:e.trim(),lyrics:"",notes:""},isGoogleDriveConnected:c})).unwrap():await a((0,r.RV)({artistName:e.trim(),isGoogleDriveConnected:c})).unwrap()}catch(t){console.error("Failed to add:",t)}}:void 0,onDeleteNode:s?async e=>{if(s)try{"artist"===e.type?await a((0,r.Xb)({artistName:e.name,isGoogleDriveConnected:c})).unwrap():"album"===e.type?await a((0,r.Dn)({artistName:e.artistName,albumTitle:e.name,isGoogleDriveConnected:c})).unwrap():"song"===e.type&&await a((0,r.B1)({artistName:e.artistName,albumTitle:e.albumTitle,songTitle:e.name,isGoogleDriveConnected:c})).unwrap()}catch(n){console.error("Failed to delete:",n)}}:void 0,showCheckbox:!1,readOnly:!s})]})]})};var N=t(5447);const k=e=>{let{onSuccess:n,onError:t,disabled:s=!1,isSignedIn:o=!1,onSignOut:l,loading:r=!1,userInfo:a=null}=e;const[c,u]=(0,i.useState)(r);(0,i.useEffect)((()=>{const e=window.open;return window.open=function(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];const[i,o,l]=t;if("string"===typeof i&&(i.includes("accounts.google.com")||i.includes("oauth")||i.includes("googleapis.com")||null!==o&&void 0!==o&&o.includes("oauth")||null!==l&&void 0!==l&&l.includes("popup"))){const n=600,t=700,s=Math.round((window.screen.width-n)/2),l=Math.round((window.screen.height-t)/2),r="width=".concat(n,",height=").concat(t,",left=").concat(s,",top=").concat(l,",scrollbars=yes,resizable=yes,toolbar=no,menubar=no,location=no,status=no");return console.log("Opening Google OAuth popup with custom dimensions:",{width:n,height:t,left:s,top:l}),e.call(this,i,o||"google_oauth",r)}if(l&&l.includes("width=")){const n=l.match(/width=(\d+)/);if(n&&parseInt(n[1])<400){const n=600,t=700,s=Math.round((window.screen.width-n)/2),l=Math.round((window.screen.height-t)/2),r="width=".concat(n,",height=").concat(t,",left=").concat(s,",top=").concat(l,",scrollbars=yes,resizable=yes,toolbar=no,menubar=no,location=no,status=no");return console.log("Resizing small popup to larger dimensions:",{width:n,height:t}),e.call(this,i,o,r)}}return e.apply(this,t)},()=>{window.open=e}}),[]);const g=(0,N.mg)({onSuccess:e=>{console.log("Google login successful:",e),u(!1),n&&n(e)},onError:e=>{console.error("Google login failed:",e),u(!1),t&&t(e)},scope:"https://www.googleapis.com/auth/drive.file",flow:"implicit",ux_mode:"popup",width:600,height:700}),p=()=>(0,d.jsxs)("svg",{className:"google-signin-icon",viewBox:"0 0 24 24",width:"18",height:"18",children:[(0,d.jsx)("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,d.jsx)("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,d.jsx)("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,d.jsx)("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]});return(0,d.jsx)("div",{className:"google-signin-container",children:(0,d.jsx)("button",{className:"google-signin-button ".concat(o?"google-signout-button":""," ").concat(s?"disabled":""," ").concat(c?"google-signin-loading":""),onClick:()=>{o&&l?l():(u(!0),console.log("About to trigger Google login..."),g())},disabled:s||c,children:o&&a?(0,d.jsxs)(d.Fragment,{children:[a.picture?(0,d.jsx)("img",{src:a.picture,alt:a.name?a.name.charAt(0).toUpperCase():"\ud83d\udc64",className:"user-avatar",onError:e=>{console.warn("Failed to load user avatar:",a.picture),e.target.style.display="none",e.target.nextElementSibling.style.display="inline-flex"}}):null,!a.picture&&(0,d.jsx)("div",{className:"user-avatar-fallback",children:a.name?a.name.charAt(0).toUpperCase():"\ud83d\udc64"}),(0,d.jsxs)("div",{className:"user-info",children:[(0,d.jsx)("span",{className:"user-name",children:a.name||a.email}),(0,d.jsx)("span",{className:"logout-hint",children:"Click to logout"})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(p,{}),(0,d.jsx)("span",{className:"google-signin-text",children:c?"Signing in":"Sign in with Google"})]})})})};var D=t(9831),E=t(7326);const{Title:G,Text:I,Paragraph:F}=D.A,{Panel:T}=E.A;var L=t(7262),z=t(2624),P=t(3382);const M=()=>{const{message:e}=p.A.useApp(),n=(0,o.wA)(),{library:t,selectedSong:c,isGoogleDriveConnected:u,userInfo:h,isLoading:m,editingEnabled:x,error:y}=(0,o.d4)((e=>e.songs)),f=(0,i.useCallback)((()=>t&&t.artists?t.artists.reduce(((e,n)=>e+n.albums.reduce(((e,n)=>e+(n.songs?n.songs.length:0)),0)),0):0),[t]),b=(0,i.useCallback)((()=>{n((0,r._J)())}),[n]),v=(0,i.useCallback)((async()=>{try{await n((0,r.Gk)()).unwrap(),console.log("Library loaded from Google Drive")}catch(y){console.error("Failed to load library from Google Drive:",y),C(y)?(e.error("Your Google Drive session has expired. Please sign in again."),n((0,r.oH)(!1)),n((0,r.iA)(null))):e.error("Failed to load library from Google Drive"),n((0,r._J)())}}),[n,e]);(0,i.useEffect)((()=>{(async()=>{try{const e="126634781504-38b58kaetcphtaq29h57sbp7qb6kc80u.apps.googleusercontent.com";if(!e)throw new Error("Google Client ID not found in environment variables");await L.A.initialize(e);const t=L.A.getSignInStatus();t.isSignedIn?(n((0,r.oH)(!0)),n((0,r.iA)({email:t.userEmail,name:t.userName,picture:t.userPicture})),console.log("Restored user session for:",t.userEmail),await v()):(console.debug("No valid session found, using mock library"),b())}catch(y){console.error("Failed to initialize Google Drive:",y),b()}})()}),[n,v,b]);const j=(0,i.useCallback)(((e,t,i)=>{if(e&&t&&i){const o=(0,s.A)((0,s.A)({},e),{},{title:e.title,artist:{name:t},album:{title:i}});n((0,r.Pe)(o)),e.chordFingerings?n((0,l.Ng)(e.chordFingerings)):n((0,l.Ng)({}))}}),[n]),C=e=>{if(!e)return!1;const n=e.message||e||"";return["User not signed in to Google Drive","Expected OAuth 2 access token","login cookie or other valid authentication credential","Invalid Credentials","Authentication failed","unauthorized_client","invalid_token","expired_token","access_denied","token_expired","Request had invalid authentication credentials"].some((e=>n.toLowerCase().includes(e.toLowerCase())))};return(0,d.jsxs)("div",{className:"song-tabs-app",children:[(0,d.jsxs)("div",{className:"header-controls",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,d.jsx)("div",{className:"edit-controls",children:(0,d.jsxs)("label",{className:"edit-toggle",children:[(0,d.jsx)(z.A,{checked:x,onChange:e=>{n((0,r.KJ)(e))},checkedChildren:(0,d.jsx)(a.YVu,{}),unCheckedChildren:(0,d.jsx)(a.JhU,{})}),(0,d.jsx)("span",{className:"edit-label",children:x?"Editing Enabled":"Read Only"})]})}),(0,d.jsx)("div",{className:"library-status-header",children:m?(0,d.jsxs)("div",{className:"loading-indicator-header",children:[(0,d.jsx)(g.A,{size:"small"}),(0,d.jsx)("span",{className:"loading-text-header",children:"Loading songs..."})]}):(0,d.jsxs)("span",{className:"library-count-header",children:[f()," ",1===f()?"song":"songs"," in library"]})}),(0,d.jsx)("div",{className:"google-drive-section",children:u?(0,d.jsx)(k,{isSignedIn:!0,onSignOut:async()=>{try{await L.A.signOut(),n((0,r.oH)(!1)),n((0,r.iA)(null)),b()}catch(y){console.error("Failed to sign out:",y)}},disabled:m,userInfo:h}):(0,d.jsx)(k,{onSuccess:async t=>{try{await L.A.handleOAuthToken(t);const e=L.A.getSignInStatus();n((0,r.oH)(!0)),n((0,r.iA)({email:e.userEmail,name:e.userName,picture:e.userPicture})),await v()}catch(y){console.error("Google Sign-In failed:",y),e.error("Failed to connect to Google Drive. Please try again.")}},onError:n=>{console.error("Google Sign-In error:",n),e.error("Failed to sign in with Google. Please try again.")},disabled:m})})]}),(0,d.jsxs)("div",{className:"songs-content",children:[(0,d.jsx)(A,{library:t,onSelectSong:j,selectedSong:c,editingEnabled:x}),c?(0,d.jsx)(w,{song:c,artist:c.artist,album:c.album,editingEnabled:x,onUpdateSong:async t=>{if(c)try{const s=c.artist.name,i=c.album.title,o=c.title;await n((0,r.Bg)({artistName:s,albumTitle:i,songTitle:o,updatedSongData:t,isGoogleDriveConnected:u})).unwrap(),e.success("Song updated successfully")}catch(y){console.error("Failed to update song:",y),C(y)?(n((0,r.oH)(!1)),n((0,r.iA)(null)),e.error("Your Google Drive session has expired. Please sign in again to save changes.")):e.error("Failed to save song changes. Please try again.")}},onPinChord:e=>{n((0,l.WV)(e))}}):(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("p",{children:"Select a song to see its chord chart, or toggle the edit lock to add and edit songs in your Google Drive library."}),!u&&(0,d.jsx)("p",{style:{color:"#666",fontSize:"0.9em"},children:"Sign in to Google Drive to access your saved songs, or use the mock library to get started."})]})]}),!1,y&&(0,d.jsxs)("div",{style:{color:"red",marginTop:"1rem"},children:["Error: ",y,(0,d.jsx)(P.Ay,{size:"small",onClick:()=>n((0,r.ET)()),style:{marginLeft:"0.5rem"},children:"Dismiss"})]})]})},R=()=>(0,d.jsx)(p.A,{children:(0,d.jsx)(M,{})})}}]);
//# sourceMappingURL=713.2a89d186.chunk.js.map