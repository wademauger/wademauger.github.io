const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["static/js/libraryThunks-CrCnpMJe.js","static/js/index-0qtAIorj.js","static/css/index-D_3jL854.css","static/js/KnittingDesignerApp-B9HeykHQ.js","static/js/index-DSNGfC1O.js","static/js/index-B37wkA5a.js","static/js/DeleteOutlined-CCD4VL_s.js","static/js/PlusOutlined-B5Qc25vv.js","static/css/KnittingDesignerApp-DTYvTHkQ.css","static/js/WizardView-BxnhRHQh.js","static/js/PanelShapeCreator-CyVFUMiT.js","static/js/index-oBBHUxli.js","static/css/PanelShapeCreator-DCxedn-s.css"])))=>i.map(i=>d[i]);
import{b as o,I as G,_ as Q,k as T,f as C,j as e,M as z,T as f,B as v,aL as _,s as g,p as N,S as X,aM as B,h as Y,aN as W,w as Z,v as ee,z as te,aO as re,aP as E,aQ as ae,aR as R,aS as se,aT as H,aU as O}from"./index-0qtAIorj.js";import{L as U,P as ne,S as le,C as F}from"./PanelShapeCreator-CyVFUMiT.js";import{R as ie}from"./PlusOutlined-B5Qc25vv.js";import{R as oe}from"./DeleteOutlined-CCD4VL_s.js";import"./index-oBBHUxli.js";import"./index-B37wkA5a.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"},de=function(p,i){return o.createElement(G,Q({},p,{ref:i,icon:ce}))},pe=o.forwardRef(de);function ye({visible:S,onClose:p,onOpen:i}){const b=T(),w=C(t=>t.library.entries||[]),I=C(t=>t.library.isLoading),P=C(t=>t.auth?.isSignedIn),y=C(t=>t.library?.selectedFile),[x,u]=o.useState([]);let l=null;try{const t=localStorage.getItem("app:libraryFileReference");if(t){const s=JSON.parse(t);s&&(s.id||s.name)&&(l={id:s.id,name:s.name})}if(!l)for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s)||"";if(n.startsWith("songsUserPreferences_")||n.startsWith("recipesUserPreferences_")||n.startsWith("songsUserPreferences_")||n.startsWith("googleDriveSettings_")||n.startsWith("songsUserPreferences_"))try{const r=JSON.parse(String(localStorage.getItem(n)));if(r){if(r.selectedFileId){l={id:r.selectedFileId,name:r.selectedFileName||r.songsLibraryFile||r.panelsLibraryFile};break}if(r.selectedFile&&r.selectedFile.id){l={id:r.selectedFile.id,name:r.selectedFile.name||r.selectedFile.fileName};break}(r.songsLibraryFile||r.recipesLibraryFile||r.panelsLibraryFile||r.songsLibraryFile)&&(l={name:r.songsLibraryFile||r.recipesLibraryFile||r.panelsLibraryFile})}}catch{}}}catch{l=l||null}const D=()=>{const t=[];try{const s=localStorage.getItem("app:libraryFileReference");if(s)try{t.push({key:"app:libraryFileReference",value:JSON.parse(s)})}catch{t.push({key:"app:libraryFileReference",value:s})}for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n)||"";if(r&&(r.startsWith("songsUserPreferences_")||r.startsWith("recipesUserPreferences_")||r.startsWith("googleDriveSettings_")||r.startsWith("songsUserPreferences_")||r.startsWith("recipesUserPreferences_"))){const d=String(localStorage.getItem(r));try{t.push({key:r,value:JSON.parse(d)})}catch{t.push({key:r,value:d})}}}}catch{}u(t),t.length?g.success("Found "+t.length+" candidate keys in localStorage"):g.info("No persisted library-related keys found in localStorage")},k=async t=>{try{if(t&&t.fileId){const{loadFullLibraryById:s}=await _(async()=>{const{loadFullLibraryById:r}=await import("./libraryThunks-CrCnpMJe.js");return{loadFullLibraryById:r}},__vite__mapDeps([0,1,2])),n=await s(t.fileId);i&&i(n,{id:t.fileId,name:t.fileName||t.name})}else if(t&&t.type&&t.id){const{openEntry:s}=await _(async()=>{const{openEntry:d}=await import("./index-0qtAIorj.js").then(m=>m.cX);return{openEntry:d}},__vite__mapDeps([1,2])),n=await b(s({id:t.id,type:t.type})),r=n&&n.payload?n.payload:null;i&&i(r,null)}else i&&i(null);p()}catch(s){g.error("Failed to open library: "+String(s))}},h=()=>{b(B("panels")),p()};return e.jsx(z,{open:S,title:"Open Library",onCancel:p,footer:null,children:!P&&!y&&!l?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx(f.Paragraph,{children:"No Google sign-in detected. Sign in or open library settings to connect a library."}),e.jsx("div",{children:e.jsx(v,{type:"primary",onClick:h,children:"Open Library Settings"})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:12,display:"flex",gap:8},children:[e.jsx(v,{onClick:async()=>{try{const{loadFullLibrary:t}=await _(async()=>{const{loadFullLibrary:s}=await import("./libraryThunks-CrCnpMJe.js");return{loadFullLibrary:s}},__vite__mapDeps([0,1,2]));await t(),g.success("Library refreshed")}catch(t){g.error("Failed to refresh library: "+String(t))}},children:"Refresh"}),e.jsx(v,{onClick:()=>D(),children:"Detect persisted library"}),e.jsx(v,{onClick:h,children:"Library Settings"})]}),(y||l)&&e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs(f.Paragraph,{children:["Selected library: ",e.jsx("strong",{children:y&&(y.name||y.id)||l&&(l.name||l.id)})]}),e.jsx(v,{onClick:async()=>{try{const t=y||l;if(!t||!t.id)throw new Error("No persisted library file id available");const{loadFullLibraryById:s}=await _(async()=>{const{loadFullLibraryById:r}=await import("./libraryThunks-CrCnpMJe.js");return{loadFullLibraryById:r}},__vite__mapDeps([0,1,2])),n=await s(t.id);if(n&&n.panels){const r=Object.keys(n.panels).map(d=>({id:d,type:"panel",title:n.panels[d].name||d,payload:n.panels[d]}));z.info({title:"Panels in library",width:640,okText:"Close",content:e.jsx("div",{children:e.jsx(N,{size:"small",dataSource:r,renderItem:d=>e.jsx(N.Item,{style:{cursor:"pointer"},onClick:async()=>{try{i&&i(d.payload||null,t),p()}catch(m){g.error("Failed to open panel: "+String(m))}},children:d.title})})})})}else i&&i(n,t),p()}catch(t){g.error("Failed to load selected library: "+String(t))}},children:"Open Selected Library"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsxs(f.Paragraph,{type:"secondary",style:{fontSize:12},children:["Debug: selectedFile: ",JSON.stringify(y)]}),e.jsxs(f.Paragraph,{type:"secondary",style:{fontSize:12},children:["Debug: persistedFileRef: ",JSON.stringify(l)]}),x.length>0&&e.jsxs("div",{style:{marginTop:6},children:[e.jsx(f.Paragraph,{type:"secondary",style:{fontSize:12,marginBottom:6},children:"Detected localStorage candidates:"}),x.map(t=>e.jsxs(f.Paragraph,{type:"secondary",style:{fontSize:11,marginBottom:4},children:[e.jsx("strong",{children:t.key}),": ",JSON.stringify(t.value)]},t.key))]})]}),I?e.jsx(X,{}):e.jsx(N,{dataSource:w,renderItem:t=>e.jsx(N.Item,{onClick:()=>k(t),style:{cursor:"pointer"},children:t.title||t.name||t.fileName})})]})})}function he({visible:S,onClose:p,fileId:i,libraryData:b,onSave:w}){const[I,P]=o.useState("library.json"),[y,x]=o.useState(!1),u=T(),l=C(t=>t.library?.selectedFile),D=()=>{u(B("panels")),p()},k=async()=>{x(!0);try{if(i){await u(W({entry:b||{},type:"panel"})).unwrap(),g.success("Saved to selected library file"),w&&w({success:!0}),p();return}l&&l.id?(await u(W({entry:b||{},type:"panel"})).unwrap(),g.success("Panel saved to current library"),w&&w({success:!0}),p()):g.error("No library selected. Please choose or create a library first.")}catch(t){g.error("Save failed: "+String(t))}finally{x(!1)}},h=!(l&&l.id)&&!i;return e.jsx(z,{visible:S,title:h?"Save Panel":"Save to Library",onCancel:p,onOk:k,confirmLoading:y,children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:h?e.jsxs("div",{children:[e.jsx(f.Paragraph,{children:"No library is currently selected. You must select or create a library before saving a panel."}),e.jsx(v,{type:"primary",onClick:D,children:"Open Library Settings"})]}):e.jsxs("div",{children:[e.jsxs(f.Paragraph,{children:["This will save the current panel into the selected library (",e.jsx("strong",{children:l?.name||i}),")."]}),e.jsx(Y,{value:I,onChange:t=>P(t.target.value),placeholder:"Optional filename"})]})})})}const ge=o.lazy(()=>_(()=>import("./KnittingDesignerApp-B9HeykHQ.js"),__vite__mapDeps([3,1,2,4,5,6,7,8]))),xe=o.lazy(()=>_(()=>import("./WizardView-BxnhRHQh.js"),__vite__mapDeps([9,1,2,10,7,6,11,5,12]))),{Title:j,Text:L}=f,{Content:fe}=U,we=()=>{const[S,p]=o.useState([]),[i,b]=o.useState(null),[w,I]=o.useState("settings");o.useRef(null);const P=o.useMemo(()=>[{id:1,name:"Raglan Sweater Front",garment:"cozy-raglan-sweater",panel:"Front",lastModified:"2 hours ago"},{id:2,name:"Hat Crown",garment:"seam-top-hat",panel:"Hat",lastModified:"1 day ago"}],[]),y=a=>{const c=l(a);b(c),x("colorwork-pattern-designer",{state:{project:c}})},x=Z(),u=ee(),l=a=>{if(a.panelShape)return a;if(a.garment&&a.panelName&&a.garment.shapes){const c=a.garment.shapes[a.panelName];if(c)return{...a,panelShape:c}}return console.warn("Could not fix legacy project - missing garment or panel data:",a),a},D=()=>e.jsxs("div",{className:"colorwork-home",children:[e.jsxs("div",{className:"home-header",children:[e.jsx(j,{level:1,children:"Machine Knitting Panel Designer"}),e.jsx(L,{type:"secondary",style:{fontSize:"16px"},children:"Create panel shapes, design colorwork patterns, and generate complete machine knitting instructions."})]}),e.jsxs(H,{gutter:[24,24],style:{marginTop:40},children:[e.jsx(O,{xs:24,md:12,lg:8,children:e.jsx(F,{hoverable:!0,className:"action-card",onClick:()=>x("panel-shape-creator"),style:{height:"200px",display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(ie,{style:{fontSize:"48px",color:"#1890ff",marginBottom:"16px"}}),e.jsx(j,{level:4,children:"Create Panel Shape"}),e.jsx(L,{type:"secondary",children:"Design custom shapes for your knitting project"})]})})}),e.jsx(O,{xs:24,md:12,lg:8,children:e.jsx(F,{hoverable:!0,className:"action-card",onClick:()=>x("colorwork-pattern-designer"),style:{height:"200px",display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(oe,{style:{fontSize:"48px",color:"#52c41a",marginBottom:"16px"}}),e.jsx(j,{level:4,children:"Create Colorwork Pattern"}),e.jsx(L,{type:"secondary",children:"Design custom colorwork grids and charts"})]})})}),e.jsx(O,{xs:24,md:12,lg:8,children:e.jsx(F,{hoverable:!0,className:"action-card",onClick:()=>x("pattern-wizard"),style:{height:"200px",display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(pe,{style:{fontSize:"48px",color:"#faad14",marginBottom:"16px"}}),e.jsx(j,{level:4,children:"Make a Knitting Pattern"}),e.jsx(L,{type:"secondary",children:"Create a plan to knit your project"})]})})})]}),(P.length>0||S.length>0)&&e.jsxs("div",{style:{marginTop:40},children:[e.jsx(j,{level:2,children:"Recent Projects"}),e.jsx(H,{gutter:[16,16],children:e.jsxs(O,{xs:24,children:[P.map(a=>e.jsx(F,{hoverable:!0,size:"small",title:a.name,extra:e.jsx(v,{type:"link",onClick:()=>{},children:"Resume"}),style:{marginBottom:"12px",cursor:"pointer"},onClick:()=>{},children:e.jsxs(L,{type:"secondary",children:["Last modified: ",a.lastModified]})},a.id)),S.map(a=>e.jsx(F,{hoverable:!0,size:"small",title:a.name,extra:e.jsx(v,{type:"link",onClick:()=>y(a),children:"Open"}),style:{marginBottom:"12px",cursor:"pointer"},onClick:()=>y(a),children:e.jsxs(L,{type:"secondary",children:["Modified: ",new Date(a.modified||a.created).toLocaleDateString()]})},a.id))]})})]})]}),{setMenuItems:k}=te(),h=T(),[t,s]=o.useState(!1),[n,r]=o.useState(!1),[d,m]=o.useState(!1),[K,M]=o.useState(!1),[V,A]=o.useState(null);return o.useEffect(()=>{const a=c=>{const{pattern:J,gridSize:$,colors:q}=c.detail;A({pattern:J,gridSize:$,colors:q}),M(!0)};return window.addEventListener("colorwork:pattern-data",a),()=>window.removeEventListener("colorwork:pattern-data",a)},[]),o.useEffect(()=>{const a=u.pathname||"";let c=[];return a.includes("panel-shape-creator")?c=[]:a.includes("colorwork-pattern-designer")?c=[{key:"colorwork-pattern-save",label:"Save Pattern",onClick:()=>{window.dispatchEvent(new Event("colorwork:request-pattern-data"))}},{key:"colorwork-pattern-open",label:"Open Pattern",onClick:()=>m(!0)}]:c=[{key:"colorwork-open-home",label:"Open...",onClick:()=>h(B("panels",{intent:"open"}))}],k(c),()=>k([])},[k,u.pathname,i,h]),e.jsx(U,{className:"colorwork-designer-app",children:e.jsx(re,{children:e.jsxs(fe,{children:[e.jsx(ye,{visible:t,onClose:()=>s(!1),onOpen:(a,c)=>{h(E({type:"colorwork:library-opened",payload:{library:a,fileRef:c}})),s(!1)}}),e.jsx(he,{visible:n,onClose:()=>r(!1),onSave:a=>{h(E({type:"colorwork:library-saved",payload:a||{}})),r(!1)},fileId:null,libraryData:i}),e.jsxs(ae,{children:[e.jsx(R,{path:"/",element:D()}),e.jsx(R,{path:"panel-shape-creator",element:e.jsxs("div",{className:"panel-shape-creator",style:{height:"100vh",display:"flex",flexDirection:"column"},children:[e.jsx("div",{className:"editor-toolbar",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 16px",borderBottom:"1px solid #f0f0f0"},children:e.jsx(j,{level:3,style:{margin:0,flex:1},children:"Panel Shape Creator"})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(ne,{})})]})}),e.jsx(R,{path:"colorwork-pattern-designer",element:e.jsxs("div",{className:"colorwork-pattern-designer",style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{className:"editor-toolbar",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 16px",borderBottom:"1px solid #f0f0f0"},children:e.jsx(j,{level:3,style:{margin:0,flex:1},children:"Colorwork Pattern Designer"})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(ge,{})})]})}),e.jsx(R,{path:"pattern-wizard",element:e.jsxs("div",{className:"pattern-wizard",style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{className:"editor-toolbar",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 16px",borderBottom:"1px solid #f0f0f0"},children:e.jsx(j,{level:3,style:{margin:0,flex:1},children:"Pattern Wizard"})}),e.jsx("div",{style:{flex:1,minHeight:0},children:e.jsx(xe,{})})]})})]}),e.jsx(se,{visible:d,jsonKey:"colorworkPatterns",settingsKey:"panels",displayLabel:"Pattern",onOpen:a=>{try{h(E({type:"colorwork:pattern-opened",payload:a}))}catch{}m(!1)},onClose:()=>m(!1)}),e.jsx(le,{visible:K,jsonKey:"colorworkPatterns",settingsKey:"panels",displayLabel:"Pattern",entityData:V,onSave:async(a,c)=>{console.log(`Pattern "${a}" saved successfully`)},onClose:()=>{M(!1),A(null)}})]})})})};export{we as default};
//# sourceMappingURL=ColorworkDesignerApp-D0U1RAG_.js.map
