import{k as re,f as W,cR as ae,cS as ie,b as p,bf as oe,Q as ce,ak as le,cT as he,bd as S,j as n,h as ue,cl as H,B as D,F as O,ah as V,cU as de,cV as pe}from"./index-C5ig_0BN.js";import{b as me}from"./PanelShapeCreator-C0yu9UAY.js";import{T as X}from"./DeleteOutlined-SZKWO26C.js";import"./PlusOutlined-DP2KcrPC.js";import"./index-J1LSphV_.js";import"./index-G2vkQwzc.js";const ge=()=>{const r=["XXS","XS","S","M","L","XL","XXL"],a=o=>r.indexOf(o)-3,l=o=>Math.pow(1.1,o),h={};return r.forEach(o=>{r.forEach(x=>{const f=a(o),y=a(x)-1;if(f===y){const v=l(f),m=`men's ${o.toLowerCase()} / women's ${x.toLowerCase()}`;h[m]=Math.round(v*1e3)/1e3}})}),h},_=ge(),q=[{permalink:"cozy-raglan-sweater",title:"Cozy Raglan V-Neck Sweater",description:"A simple sweater with Raglan sleeves",sizes:_,shapes:{Front:{height:4,baseA:25,baseB:25,finishingSteps:["Hang hem."],successors:[{height:20,baseA:25,baseB:25,successors:[{height:0,baseA:1,baseB:1},{height:8,baseA:10,baseB:3},{height:0,baseA:2,baseB:2},{height:8,baseA:10,baseB:3},{height:0,baseA:1,baseB:1}]}]},Back:{height:4,baseA:25,baseB:25,finishingSteps:["Hang hem."],successors:[{height:20,baseA:25,baseB:25,successors:[{height:0,baseA:1,baseB:1},{height:8,baseA:23,baseB:15},{height:0,baseA:1,baseB:1}]}]},"Sleeves (make 2)":{height:4,baseA:10,baseB:10,successors:[{height:14,baseA:10,baseB:20,successors:[{height:7,baseA:20,baseB:3}]}]}},finishingSteps:["Lay out the panels and sleeves, right sides together, and knit the collar in whatever style you prefer.","Sew up the side seams and sleeve seams.","Weave in all ends."]},{permalink:"seam-top-hat",title:"Seam-Top Hat",description:"A simple hat with an elegant construction",sizes:{"One Size":1},shapes:{Hat:{height:4,baseA:22,baseB:22,finishingSteps:["Hang hem."],successors:[{height:10,baseA:22,baseB:22,successors:[{height:4,baseA:5.5,baseB:.2},{height:4,baseA:5.5,baseB:.2},{height:4,baseA:5.5,baseB:.2},{height:4,baseA:5.5,baseB:.2}]}]}},finishingSteps:["Either use sew-as-you-go to join the top panels on the machine, or sew with a tapestry needle after binding off.","Sew up the back seam.","Add braided ear strings if desired."]},{permalink:"drop-shoulder-crew-neck-sweater",title:"Drop-Shoulder Crew Neck Sweater",description:"A cozy drop-shoulder sweater with a classic crew neck",sizes:_,shapes:{Front:{height:5,baseA:5,baseB:5,successors:[{height:5,baseA:5,baseB:5,successors:[{height:5,baseA:5,baseB:5}]}]},Back:{height:5,baseA:30,baseB:30,finishingSteps:["Hang hem."],successors:[{height:20,baseA:30,baseB:30,successors:[{height:0,baseA:3,baseB:3},{height:10,baseA:10,baseB:10},{height:0,baseA:4,baseB:4},{height:10,baseA:10,baseB:10},{height:0,baseA:3,baseB:3}]}]},"Sleeves (make 2)":{height:4,baseA:10,baseB:10,successors:[{height:20,baseA:10,baseB:21}]}}}],I=r=>{if(typeof r=="number"&&Number.isFinite(r))return r;const a=Number(r);return Number.isFinite(a)?a:0},N=r=>r<0?0:r,be=r=>{const a=I(r);return a===0?1:Math.abs(a)},Q=(r,a,l,h,o)=>{if(!r||typeof r!="object")return;const x=N(I(r.baseA)),f=N(I(r.baseB)),y=N(I(r.height)),v=I(r.baseBHorizontalOffset),m=x*a,C=f*a,R=y*a,u=Math.max(m,C),P=l+(u-C)/2+v*a,z=l+(u+C)/2+v*a,T=l+(u-m)/2,g=l+(u+m)/2,E=h,M=h+R;o.minX=Math.min(o.minX,P,z,T,g),o.maxX=Math.max(o.maxX,P,z,T,g),o.minY=Math.min(o.minY,E,M),o.maxY=Math.max(o.maxY,E,M);const A=Array.isArray(r.successors)?r.successors.filter(b=>b&&typeof b=="object"):[];if(!A.length)return;const j=A.map(b=>{const w=N(I(b.baseA)),B=N(I(b.baseB));return Math.max(w,B)*a}),L=j.reduce((b,w)=>b+w,0);let F=l+(u-L)/2;A.forEach((b,w)=>{const B=N(I(b.height))*a,$=j[w]||0;Q(b,a,F,E-B,o),F+=$})},fe=(r,a=1)=>{if(!r||typeof r!="object")return null;const l=be(a||1),h={minX:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};if(Q(r,l,0,0,h),!Number.isFinite(h.minX)||!Number.isFinite(h.maxX)||!Number.isFinite(h.minY)||!Number.isFinite(h.maxY))return null;const o=h.maxX-h.minX,x=h.maxY-h.minY;return!Number.isFinite(o)||!Number.isFinite(x)?null:{widthInches:o,heightInches:x,bounds:h}},ve=()=>{const r=re(),a=W(ae),l=W(ie)||0,[h,o]=p.useState(a?.name||""),{isSignedIn:x}=oe(),f=W(e=>e.library?.fullLibrary);p.useEffect(()=>{x?r(ce()):(r(le(null)),r(he()))},[x,r]);const y=p.useMemo(()=>{const e=[];return(q||[]).forEach(s=>{const t=s.shapes||{};Object.keys(t).forEach(i=>{e.push({key:`${s.permalink}::${i}`,garmentTitle:s.title,garmentPermalink:s.permalink,panelName:i})})}),f&&f.panels&&Object.keys(f.panels).forEach(s=>{const i=f.panels[s].name||s;e.push({key:`library::${s}`,garmentTitle:"My Library",garmentPermalink:"library",panelName:i})}),e},[f]),v=a&&a.panels&&a.panels.panelsNeeded||{},[m,C]=p.useState(()=>({...v})),R=(e,s)=>{const t=s??0,i={...m,[e]:t};C(i),r(S({section:"panels",data:{panelsNeeded:i}}))},[u,P]=p.useState(a?.panels?.previewPanelKey||null),z=p.useCallback((e,s)=>e?Array.isArray(e)?e.find(t=>t&&(t.id===s||t.name===s)):typeof e=="object"?e[s]?e[s]:Object.values(e).find(i=>i&&(i.id===s||i.name===s))||null:null:null,[]),T=p.useCallback(e=>{if(!e)return null;const[s,t=""]=e.split("::");if(s==="library"){const c=z(f?.panels,t);return c&&(c.shapes||c.shape||c.panelShape)||null}const d=q.find(c=>c.permalink===s)?.shapes||{};return d?d[t]:null},[f?.panels,z]),g=p.useMemo(()=>Object.keys(m).filter(e=>(m[e]||0)>0),[m]),E=p.useCallback(e=>{if(!e)return"";const s=y.find(i=>i.key===e);if(s)return`${s.garmentTitle} â€” ${s.panelName}`;const[,t="Panel"]=e.split("::");return t},[y]),M=p.useCallback(e=>{P(e),r(S({section:"panels",data:{previewPanelKey:e}}))},[r]);p.useEffect(()=>{const e=a?.panels?.previewPanelKey;if(e&&g.includes(e)){u!==e&&P(e);return}if(!u&&g.length>0){const s=g[0];P(s),r(S({section:"panels",data:{previewPanelKey:s}}))}if(u&&!g.includes(u)){const s=g[0]||null;P(s),r(S({section:"panels",data:{previewPanelKey:s}}))}},[g,u,a?.panels?.previewPanelKey]);const[A,j]=p.useState(!0),[L,F]=p.useState([]),b=p.useRef(null);p.useEffect(()=>{if(Array.from(new Set(y.map(e=>e.garmentTitle))),b.current===null||b.current!==l){if(l>1){const e=Array.from(new Set(Object.keys(m).filter(s=>(m[s]||0)>0).map(s=>{const t=y.find(i=>i.key===s);return t?t.garmentTitle:null}).filter(Boolean)));F(e),j(!1)}else F([]),j(!0);b.current=l}},[y,l,m]);const w=p.useRef([]);p.useEffect(()=>{const e=w.current[l];e&&typeof e.scrollIntoView=="function"&&e.scrollIntoView({behavior:"smooth",block:"center"})},[l]);const B=e=>{const s=a&&a.gauge||{},t={...s,...e},i=typeof t.scaleFactor=="number"?t.scaleFactor:t.scaleFactor??1,d=typeof t.stitchesPerInch=="number"?t.stitchesPerInch:s.stitchesPerInch||0,c=typeof t.rowsPerInch=="number"?t.rowsPerInch:s.rowsPerInch||0,k=d*4,Y=c*4;r(S({section:"gauge",data:{stitchesPerInch:d,rowsPerInch:c,scaleFactor:i,stitchesPerFourInches:k,rowsPerFourInches:Y}}))},$=(e,s)=>{if(s==null)return;const t=s/4;B({[e]:t})},U=e=>{e!=null&&B({scaleFactor:e})},J=e=>{const s=e.target.value;o(s),r(S({section:"meta",data:{name:s}}))},Z=()=>{r(pe())},ee=()=>r(de());return n.jsxs("div",{style:{padding:12},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l>=0&&n.jsx("div",{ref:e=>{w.current[0]=e},style:{padding:12,borderRadius:6,background:"#fff"},children:n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start",flexWrap:"wrap"},children:[n.jsxs("div",{style:{flex:"1 1 320px",minWidth:220},children:[n.jsx("label",{style:{display:"block",fontWeight:700,marginBottom:6},children:"Pattern name"}),n.jsx(ue,{value:h,onChange:J})]}),n.jsxs("div",{style:{flex:"0 0 280px",minWidth:200,display:"flex",gap:8,alignItems:"center"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[n.jsx("label",{style:{fontSize:13},children:'Stitches per 4":'}),n.jsx(X,{min:1,value:a?.gauge?.stitchesPerFourInches,onChange:e=>$("stitchesPerInch",e)})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[n.jsx("label",{style:{fontSize:13},children:'Rows per 4":'}),n.jsx(X,{min:1,value:a?.gauge?.rowsPerFourInches,onChange:e=>$("rowsPerInch",e)})]})]}),n.jsx("div",{style:{flex:"0 0 120px",minWidth:100,display:"flex",gap:8,alignItems:"center"},children:n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[n.jsx("label",{style:{fontSize:13},children:"Scale"}),n.jsx(X,{min:.1,step:.1,value:a?.gauge?.scaleFactor??1,onChange:e=>U(e)})]})})]})},"step-0"),l>=1&&n.jsx("div",{ref:e=>{w.current[1]=e},style:{padding:12,borderRadius:6,background:"#fff",marginTop:4},children:n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:(()=>{const e={};y.forEach(t=>{e[t.garmentTitle]||(e[t.garmentTitle]=[]),e[t.garmentTitle].push({key:t.key,panelName:t.panelName})});const s=Object.keys(e);return n.jsxs("div",{children:[n.jsx(H,{activeKey:L,onChange:t=>F(Array.isArray(t)?t:[t]),children:s.map(t=>!A&&!e[t].some(i=>g.includes(i.key))?null:n.jsx(H.Panel,{header:t,children:n.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:12},children:e[t].map(({key:i,panelName:d})=>n.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:220},children:n.jsxs("div",{style:{minWidth:160},children:[n.jsx("label",{style:{display:"block",fontSize:13,color:"#333"},children:d}),n.jsx("div",{style:{fontSize:12,color:"#666"},children:n.jsx(X,{min:0,value:m[i]||0,onChange:c=>R(i,c)})})]})},i))})},t))}),!A&&n.jsx("div",{style:{marginTop:8},children:n.jsx(D,{type:"link",onClick:()=>j(!0),children:"More..."})})]})})()})},"step-1"),l>=2&&n.jsx("div",{ref:e=>{w.current[2]=e},style:{padding:8,borderRadius:6,background:"#fff",marginTop:4},children:n.jsxs("div",{style:{minHeight:360},children:[n.jsx(O,{layout:"horizontal",children:n.jsx(O.Item,{label:"Choose panel to preview:",style:{marginBottom:8},children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[n.jsx(V,{value:u,onChange:e=>{P(e),r(S({section:"panels",data:{previewPanelKey:e}}))},placeholder:g.length===0?"No panels selected in Step 2":"Select a panel",disabled:g.length===0,style:{width:360},children:g.map(e=>{const[s,t]=e.split("::"),i=y.find(c=>c.key===e),d=i?`${i.garmentTitle} â€” ${i.panelName}`:t;return n.jsx(V.Option,{value:e,children:d},e)})}),n.jsx("div",{style:{padding:"6px 12px",background:"#f5f5f5",borderRadius:4,fontSize:12,color:"#333"},children:u&&a?.gauge?(()=>{try{const e=T(u);if(!e)return null;const s=a.gauge||{},t=typeof s.scaleFactor=="number"?s.scaleFactor:1,i=Number.isFinite(t)&&t>0?t:1,d=fe(e,i);if(!d)return null;const c=typeof s.stitchesPerFourInches=="number"?s.stitchesPerFourInches:typeof s.stitchesPerInch=="number"?s.stitchesPerInch*4:0,k=typeof s.rowsPerFourInches=="number"?s.rowsPerFourInches:typeof s.rowsPerInch=="number"?s.rowsPerInch*4:0;if(!c||!k)return`@ ${Math.round(c||0)} sts Ã— ${Math.round(k||0)} rows per 4"`;const Y=c/4,K=k/4,se=Math.round(d.widthInches*Y),te=Math.round(d.heightInches*K),ne=`@ ${Math.round(c)} sts Ã— ${Math.round(k)} rows per 4"`,G=i===1?"":`, resized by ${i}x`;return`${se} stitches Ã— ${te} rows ${ne}${G?`${G}: `:": "}(${d.widthInches.toFixed(1)}" Ã— ${d.heightInches.toFixed(1)}")`}catch(e){console.warn("Error calculating panel dimensions:",e)}return null})():a?.gauge?`@ ${Math.round(a.gauge.stitchesPerFourInches||0)} sts Ã— ${Math.round(a.gauge.rowsPerFourInches||0)} rows per 4"`:"No gauge set"})]})})}),u?(()=>{const e=T(u),s=a?.gauge||null,t=s&&typeof s.stitchesPerFourInches=="number"?s.stitchesPerFourInches:s&&typeof s.stitchesPerInch=="number"?s.stitchesPerInch*4:void 0,i=s&&typeof s.rowsPerFourInches=="number"?s.rowsPerFourInches:s&&typeof s.rowsPerInch=="number"?s.rowsPerInch*4:void 0,d=s&&typeof t=="number"&&typeof i=="number"?{stitchesPerFourInches:t,rowsPerFourInches:i,scalingFactor:typeof s.scaleFactor=="number"&&s.scaleFactor>0?s.scaleFactor:1}:null,c={shape:e||null,gauge:d};return n.jsx(me,{initialPanel:c,previewKey:u,allSelectedPanelKeys:g,getPanelLabel:E,onRequestPreviewKeyChange:M},u||"none")})():n.jsx("div",{style:{padding:"20px 0",color:"#666"},children:"Select a panel above to preview and layer colorwork."})]})},"step-2")]}),n.jsxs("div",{style:{marginTop:16},children:[n.jsx(D,{onClick:ee,style:{marginRight:8},children:"Previous"}),n.jsx(D,{type:"primary",onClick:Z,children:"Next"})]})]})};export{ve as default};
//# sourceMappingURL=WizardView-0Rt2z_c-.js.map
